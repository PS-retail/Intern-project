{"ast":null,"code":"/*!\n *  __  __    _    ____ _   _ ___ _______   __\n * |  \\/  |  / \\  / ___| \\ | |_ _|  ___\\ \\ / /\n * | |\\/| | / _ \\| |  _|  \\| || || |_   \\ V /\n * | |  | |/ ___ \\ |_| | |\\  || ||  _|   | |\n * |_|  |_/_/   \\_\\____|_| \\_|___|_|     |_|\n *\n * jquery.magnify - v1.6.3\n * A jQuery plugin to view images just like in windows\n * https://github.com/nzbin/magnify#readme\n *\n * Copyright (c) 2017 nzbin\n * Released under the MIT License\n */\n;\n\n(function (factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as anonymous module.\n    define(['jquery'], factory);\n  } else if (typeof exports === 'object') {\n    // Node / CommonJS\n    factory(require('jquery'));\n  } else {\n    // Browser globals.\n    factory(jQuery);\n  }\n})(function ($) {\n  'use strict';\n  /**\n   * Private Functions\n   */\n\n  /**\n   * Get image src from `data-src`\n   * @param {Object} el - image\n   */\n\n  function getImageSrc(el) {\n    // Get data-src as image src at first\n    var src = $(el).attr('data-src') ? $(el).attr('data-src') : $(el).attr('href');\n    return src;\n  }\n  /**\n   * Throttle function\n   * @param {Function} fn - The function will be triggered\n   * @param {Number} delay - The throttle delay time\n   * @return {Function}\n   */\n\n\n  function throttle(fn, delay) {\n    var timer = null;\n    return function () {\n      var context = this,\n          args = arguments;\n      clearTimeout(timer);\n      timer = setTimeout(function () {\n        fn.apply(context, args);\n      }, delay);\n    };\n  }\n  /**\n   * Preload a image\n   * @param {String} src - The image src\n   * @param {Function} success - The callback of success\n   * @param {Function} error - The callback of error\n   */\n\n\n  function preloadImage(src, success, error) {\n    var img = new Image();\n\n    img.onload = function () {\n      success(img);\n    };\n\n    img.onerror = function () {\n      error(img);\n    };\n\n    img.src = src;\n  }\n  /**\n   * Request fullscreen\n   * @param {type} element\n   */\n\n\n  function requestFullscreen(element) {\n    if (element.requestFullscreen) {\n      element.requestFullscreen();\n    } else if (element.mozRequestFullScreen) {\n      element.mozRequestFullScreen();\n    } else if (element.webkitRequestFullscreen) {\n      element.webkitRequestFullscreen();\n    } else if (element.msRequestFullscreen) {\n      element.msRequestFullscreen();\n    }\n  }\n  /**\n   * Exit fullscreen\n   */\n\n\n  function exitFullscreen() {\n    if (document.exitFullscreen) {\n      document.exitFullscreen();\n    } else if (document.mozCancelFullScreen) {\n      document.mozCancelFullScreen();\n    } else if (document.webkitExitFullscreen) {\n      document.webkitExitFullscreen();\n    }\n  }\n  /**\n   * Get the image name from its url\n   * @param {String} url - The image src\n   * @return {String}\n   */\n\n\n  function getImageNameFromUrl(url) {\n    var reg = /^.*?\\/*([^/?]*)\\.[a-z]+(\\?.+|$)/gi,\n        txt = url.replace(reg, '$1');\n    return txt;\n  }\n  /**\n   * Check if the document has a scrollbar\n   * @return {Boolean}\n   */\n\n\n  function hasScrollbar() {\n    return document.body.scrollHeight > (window.innerHeight || document.documentElement.clientHeight);\n  }\n  /**\n   * Get the scrollbar width\n   * @return {Number}\n   */\n\n\n  function getScrollbarWidth() {\n    var scrollDiv = document.createElement('div');\n    scrollDiv.style.cssText = 'width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;';\n    document.body.appendChild(scrollDiv);\n    var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n    document.body.removeChild(scrollDiv);\n    return scrollbarWidth;\n  }\n  /**\n   * Set grab cursor when move image\n   * @param {Object} imageData - The image data\n   * @param {Object} stageData - The stage data\n   * @param {Object} stage - The stage element\n   * @param {Boolean} isRotate - The image rotated flag\n   */\n\n\n  function setGrabCursor(imageData, stageData, stage, isRotated) {\n    var imageWidth = !isRotated ? imageData.w : imageData.h;\n    var imageHeight = !isRotated ? imageData.h : imageData.w;\n\n    if (imageHeight > stageData.h || imageWidth > stageData.w) {\n      stage.addClass('is-grab');\n    }\n\n    if (imageHeight <= stageData.h && imageWidth <= stageData.w) {\n      stage.removeClass('is-grab');\n    }\n  }\n  /**\n   * Check if browser support touch event\n   * @return {Boolean}\n   */\n\n\n  function supportTouch() {\n    return !!('ontouchstart' in window || window.DocumentTouch && document instanceof window.DocumentTouch);\n  }\n  /**\n   * Check if the browser is IE8\n   * @return {Boolean}\n   */\n\n\n  function isIE8() {\n    return navigator.appName == 'Microsoft Internet Explorer' && navigator.appVersion.indexOf('MSIE 8.0') > 0 || navigator.appName == 'Microsoft Internet Explorer' && navigator.appVersion.indexOf('MSIE 7.0') > 0;\n  }\n  /**\n   * Private static constants\n   */\n\n\n  var $W = $(window),\n      $D = $(document),\n      CLICK_EVENT = 'click',\n      RESIZE_EVENT = 'resize',\n      KEYDOWN_EVENT = 'keydown',\n      WHEEL_EVENT = 'wheel mousewheel DOMMouseScroll',\n      TOUCH_START_EVENT = supportTouch() ? 'touchstart' : 'mousedown',\n      TOUCH_MOVE_EVENT = supportTouch() ? 'touchmove' : 'mousemove',\n      TOUCH_END_EVENT = supportTouch() ? 'touchend' : 'mouseup',\n      NS = 'magnify',\n      EVENT_NS = '.' + NS,\n      // Plugin default options\n  DEFAULTS = {\n    // Enable modal to drag\n    draggable: true,\n    // Enable modal to resize\n    resizable: true,\n    // Enable image to move\n    movable: true,\n    // Enable keyboard navigation\n    keyboard: true,\n    // Shows the title\n    title: true,\n    // Min width of modal\n    modalWidth: 320,\n    // Min height of modal\n    modalHeight: 320,\n    // Enable the page content fixed\n    fixedContent: true,\n    // Disable the modal size fixed\n    fixedModalSize: false,\n    // Disable the image viewer maximized on init\n    initMaximized: false,\n    // Threshold of modal to browser window\n    gapThreshold: 0.02,\n    // Threshold of image ratio\n    ratioThreshold: 0.1,\n    // Min ratio of image when zoom out\n    minRatio: 0.05,\n    // Max ratio of image when zoom in\n    maxRatio: 16,\n    // Toolbar options in header\n    headerToolbar: ['maximize', 'close'],\n    // Toolbar options in footer\n    footerToolbar: ['zoomIn', 'zoomOut', 'prev', 'fullscreen', 'next', 'actualSize', 'rotateRight'],\n    // Customize button icon\n    icons: {\n      minimize: '<svg viewBox=\"0 0 1024 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M1024 749.714v109.714c0 50.286-41.143 91.429-91.429 91.429\\\n          h-841.143c-50.286 0-91.429-41.143-91.429-91.429v-109.714c0-50.286 41.143-91.429 91.429\\\n          -91.429h841.143c50.286 0 91.429 41.143 91.429 91.429z\"></path>\\\n        </svg>',\n      maximize: '<svg viewBox=\"0 0 1024 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M146.286 804.571h731.429v-438.857h-731.429v438.857z\\\n          M1024 164.571v694.857c0 50.286-41.143 91.429-91.429 91.429h-841.143c-50.286 0\\\n          -91.429-41.143-91.429-91.429v-694.857c0-50.286 41.143-91.429 91.429-91.429\\\n          h841.143c50.286 0 91.429 41.143 91.429 91.429z\"></path>\\\n        </svg>',\n      close: '<svg viewBox=\"0 0 804.5714285714286 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M741.714 755.429c0 14.286-5.714 28.571-16 38.857\\\n          l-77.714 77.714c-10.286 10.286-24.571 16-38.857 16s-28.571-5.714-38.857-16l-168-168\\\n          -168 168c-10.286 10.286-24.571 16-38.857 16s-28.571-5.714-38.857-16l-77.714-77.714\\\n          c-10.286-10.286-16-24.571-16-38.857s5.714-28.571 16-38.857l168-168-168-168c-10.286-10.286\\\n          -16-24.571-16-38.857s5.714-28.571 16-38.857l77.714-77.714c10.286-10.286 24.571-16 38.857\\\n          -16s28.571 5.714 38.857 16l168 168 168-168c10.286-10.286 24.571-16 38.857-16\\\n          s28.571 5.714 38.857 16l77.714 77.714c10.286 10.286 16 24.571 16 38.857s-5.714 28.571\\\n          -16 38.857l-168 168 168 168c10.286 10.286 16 24.571 16 38.857z\"></path>\\\n        </svg>',\n      zoomIn: '<svg viewBox=\"0 0 950.8571428571428 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M585.143 457.143v36.571c0 9.714-8.571 18.286-18.286 18.286\\\n          h-128v128c0 9.714-8.571 18.286-18.286 18.286h-36.571c-9.714 0-18.286-8.571-18.286-18.286\\\n          v-128h-128c-9.714 0-18.286-8.571-18.286-18.286v-36.571c0-9.714 8.571-18.286 18.286-18.286\\\n          h128v-128c0-9.714 8.571-18.286 18.286-18.286h36.571c9.714 0 18.286 8.571 18.286 18.286\\\n          v128h128c9.714 0 18.286 8.571 18.286 18.286zM658.286 475.429c0-141.143-114.857-256-256\\\n          -256s-256 114.857-256 256 114.857 256 256 256 256-114.857 256-256zM950.857 950.857\\\n          c0 40.571-32.571 73.143-73.143 73.143-19.429 0-38.286-8-51.429-21.714l-196-195.429\\\n          c-66.857 46.286-146.857 70.857-228 70.857-222.286 0-402.286-180-402.286-402.286s180\\\n          -402.286 402.286-402.286 402.286 180 402.286 402.286c0 81.143-24.571 161.143-70.857 228\\\n          l196 196c13.143 13.143 21.143 32 21.143 51.429z\"></path>\\\n        </svg>',\n      zoomOut: '<svg viewBox=\"0 0 950.8571428571428 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M585.143 457.143v36.571c0 9.714-8.571 18.286-18.286 18.286\\\n          h-329.143c-9.714 0-18.286-8.571-18.286-18.286v-36.571c0-9.714 8.571-18.286 18.286-18.286\\\n          h329.143c9.714 0 18.286 8.571 18.286 18.286zM658.286 475.429c0-141.143-114.857-256-256\\\n          -256s-256 114.857-256 256 114.857 256 256 256 256-114.857 256-256zM950.857 950.857\\\n          c0 40.571-32.571 73.143-73.143 73.143-19.429 0-38.286-8-51.429-21.714l-196-195.429\\\n          c-66.857 46.286-146.857 70.857-228 70.857-222.286 0-402.286-180-402.286-402.286s180\\\n          -402.286 402.286-402.286 402.286 180 402.286 402.286c0 81.143-24.571 161.143-70.857 228\\\n          l196 196c13.143 13.143 21.143 32 21.143 51.429z\"></path>\\\n        </svg>',\n      prev: '<svg viewBox=\"0 0 914.2857142857142 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M877.714 512v73.143c0 38.857-25.714 73.143-66.857 73.143\\\n          h-402.286l167.429 168c13.714 13.143 21.714 32 21.714 51.429s-8 38.286-21.714 51.429\\\n          l-42.857 43.429c-13.143 13.143-32 21.143-51.429 21.143s-38.286-8-52-21.143l-372-372.571\\\n          c-13.143-13.143-21.143-32-21.143-51.429s8-38.286 21.143-52l372-371.429c13.714\\\n          -13.714 32.571-21.714 52-21.714s37.714 8 51.429 21.714l42.857 42.286\\\n          c13.714 13.714 21.714 32.571 21.714 52s-8 38.286-21.714 52l-167.429 167.429h402.286\\\n          c41.143 0 66.857 34.286 66.857 73.143z\"></path>\\\n        </svg>',\n      next: '<svg viewBox=\"0 0 841.1428571428571 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M841.143 548.571c0 19.429-7.429 38.286-21.143 52l-372 372\\\n          c-13.714 13.143-32.571 21.143-52 21.143s-37.714-8-51.429-21.143l-42.857-42.857c-13.714\\\n          -13.714-21.714-32.571-21.714-52s8-38.286 21.714-52l167.429-167.429h-402.286c-41.143 0\\\n          -66.857-34.286-66.857-73.143v-73.143c0-38.857 25.714-73.143 66.857-73.143h402.286\\\n          l-167.429-168c-13.714-13.143-21.714-32-21.714-51.429s8-38.286 21.714-51.429l42.857\\\n          -42.857c13.714-13.714 32-21.714 51.429-21.714s38.286 8 52 21.714l372 372\\\n          c13.714 13.143 21.143 32 21.143 51.429z\"></path>\\\n        </svg>',\n      fullscreen: '<svg viewBox=\"0 0 1097.142857142857 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M365.714 329.143c0 60.571-49.143 109.714-109.714 109.714\\\n          s-109.714-49.143-109.714-109.714 49.143-109.714 109.714\\\n          -109.714 109.714 49.143 109.714 109.714zM950.857 548.571v256h-804.571v-109.714l182.857\\\n          -182.857 91.429 91.429 292.571-292.571zM1005.714 146.286h-914.286c-9.714 0-18.286 8.571\\\n          -18.286 18.286v694.857c0 9.714 8.571 18.286 18.286 18.286h914.286c9.714 0 18.286\\\n          -8.571 18.286-18.286v-694.857c0-9.714-8.571-18.286-18.286-18.286zM1097.143 164.571\\\n          v694.857c0 50.286-41.143 91.429-91.429 91.429h-914.286c-50.286 0-91.429-41.143-91.429\\\n          -91.429v-694.857c0-50.286 41.143-91.429 91.429-91.429h914.286\\\n          c50.286 0 91.429 41.143 91.429 91.429z\"></path>\\\n        </svg>',\n      actualSize: '<svg viewBox=\"0 0 877.7142857142857 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M733.143 309.143l-202.857 202.857 202.857 202.857 82.286\\\n          -82.286c10.286-10.857 26.286-13.714 40-8 13.143 5.714 22.286 18.857 22.286 33.714v256\\\n          c0 20-16.571 36.571-36.571 36.571h-256c-14.857 0-28-9.143-33.714-22.857-5.714-13.143\\\n          -2.857-29.143 8-39.429l82.286-82.286-202.857-202.857-202.857 202.857 82.286 82.286\\\n          c10.857 10.286 13.714 26.286 8 39.429-5.714 13.714-18.857 22.857-33.714 22.857h-256\\\n          c-20 0-36.571-16.571-36.571-36.571v-256c0-14.857 9.143-28 22.857-33.714 13.143\\\n          -5.714 29.143-2.857 39.429 8l82.286 82.286 202.857-202.857-202.857-202.857-82.286 82.286\\\n          c-6.857 6.857-16 10.857-25.714 10.857-4.571 0-9.714-1.143-13.714-2.857-13.714-5.714\\\n          -22.857-18.857-22.857-33.714v-256c0-20 16.571-36.571 36.571-36.571h256\\\n          c14.857 0 28 9.143 33.714 22.857 5.714 13.143 2.857 29.143-8 39.429\\\n          l-82.286 82.286 202.857 202.857 202.857-202.857-82.286-82.286c-10.857-10.286-13.714\\\n          -26.286-8-39.429 5.714-13.714 18.857-22.857 33.714-22.857h256\\\n          c20 0 36.571 16.571 36.571 36.571v256c0 14.857-9.143 28-22.286 33.714-4.571 1.714\\\n          -9.714 2.857-14.286 2.857-9.714 0-18.857-4-25.714-10.857z\"></path>\\\n        </svg>',\n      rotateLeft: '<svg viewBox=\"0 0 877.7142857142857 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M877.714 512c0 241.714-197.143 438.857-438.857 438.857\\\n          -130.857 0-254.286-57.714-337.714-158.286-5.714-7.429-5.143-18.286 1.143-24.571l78.286\\\n          -78.857c4-3.429 9.143-5.143 14.286\\\n          -5.143 5.143 0.571 10.286 2.857 13.143 6.857 56 72.571 140 113.714 230.857 113.714 161.143 0 292.571\\\n          -131.429 292.571-292.571s-131.429-292.571-292.571-292.571c-74.857 0-145.714 28.571\\\n          -198.857 78.286l78.286 78.857c10.857 10.286 13.714 26.286 8 39.429-5.714 13.714\\\n          -18.857 22.857-33.714 22.857h-256c-20 0-36.571-16.571-36.571-36.571v-256\\\n          c0-14.857 9.143-28 22.857-33.714 13.143-5.714 29.143-2.857 39.429 8l74.286 73.714\\\n          c80.571-76 189.714-121.143 302.286-121.143 241.714 0 438.857 197.143 438.857 438.857z\"></path>\\\n        </svg>',\n      rotateRight: '<svg viewBox=\"0 0 877.7142857142857 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M877.714 146.286v256c0 20-16.571 36.571-36.571 36.571h-256\\\n          c-14.857 0-28-9.143-33.714-22.857-5.714-13.143-2.857-29.143 8-39.429l78.857-78.857\\\n          c-53.714-49.714-124.571-78.286-199.429-78.286-161.143 0-292.571 131.429-292.571 292.571\\\n          s131.429 292.571 292.571 292.571c90.857 0 174.857-41.143 230.857-113.714 2.857-4 8\\\n          -6.286 13.143-6.857 5.143 0 10.286 1.714 14.286 5.143l78.286 78.857\\\n          c6.857 6.286 6.857 17.143 1.143 24.571-83.429 100.571-206.857 158.286-337.714 158.286\\\n          -241.714 0-438.857-197.143-438.857-438.857s197.143-438.857 438.857-438.857\\\n          c112.571 0 221.714 45.143 302.286 121.143l74.286-73.714c10.286-10.857 26.286-13.714 40\\\n          -8 13.143 5.714 22.286 18.857 22.286 33.714z\"></path>\\\n        </svg>'\n    },\n    // Customize language of button title\n    i18n: {\n      minimize: 'minimize',\n      maximize: 'maximize',\n      close: 'close',\n      zoomIn: 'zoom-in(+)',\n      zoomOut: 'zoom-out(-)',\n      prev: 'prev(←)',\n      next: 'next(→)',\n      fullscreen: 'fullscreen',\n      actualSize: 'actual-size(Ctrl+Alt+0)',\n      rotateLeft: 'rotate-left(Ctrl+,)',\n      rotateRight: 'rotate-right(Ctrl+.)'\n    },\n    // Enable multiple instances\n    multiInstances: true,\n    // Init trigger event\n    initEvent: 'click',\n    // Enable animation\n    initAnimation: true,\n    // Disable modal position fixed when change images\n    fixedModalPos: false,\n    // Modal z-index\n    zIndex: 1090,\n    // Selector of drag handler\n    dragHandle: false,\n    // Callback events\n    callbacks: {\n      beforeOpen: $.noop,\n      opened: $.noop,\n      beforeClose: $.noop,\n      closed: $.noop,\n      beforeChange: $.noop,\n      changed: $.noop\n    },\n    // Load the image progressively\n    progressiveLoading: true,\n    // Custom Buttons\n    customButtons: {}\n  },\n      PUBLIC_VARS = {\n    // Image moving flag\n    isMoving: false,\n    // Modal resizing flag\n    isResizing: false,\n    // Modal z-index setting\n    zIndex: DEFAULTS.zIndex\n  }; // jQuery element of calling plugin\n\n  var jqEl = null;\n  /**\n   * Magnify Class\n   */\n\n  var Magnify = function (el, options) {\n    var self = this;\n    this.options = $.extend(true, {}, DEFAULTS, options);\n\n    if (options && $.isArray(options.footerToolbar)) {\n      this.options.footerToolbar = options.footerToolbar;\n    }\n\n    if (options && $.isArray(options.headerToolbar)) {\n      this.options.headerToolbar = options.headerToolbar;\n    } // Store element of clicked\n\n\n    this.$el = $(el); // As we have multiple instances,\n    // so every instance has following variables.\n    // modal open flag\n\n    this.isOpened = false; // modal maximize flag\n\n    this.isMaximized = false; // image rotate 90*(2n+1) flag\n\n    this.isRotated = false; // image rotate angle\n\n    this.rotateAngle = 0; // if modal do resize\n\n    this.isDoResize = false; // Store image data in every instance\n\n    this.imageData = {}; // Store modal data in every instance\n\n    this.modalData = {\n      width: null,\n      height: null,\n      left: null,\n      top: null\n    };\n    this.init(el, self.options);\n  };\n  /**\n   * Mangify Prototype\n   */\n\n\n  Magnify.prototype = {\n    init: function (el, opts) {\n      // Get image src\n      var imgSrc = getImageSrc(el); // Get image group\n\n      this.groupName = null;\n      var currentGroupName = $(el).attr('data-group'),\n          groupList = $D.find('[data-group=\"' + currentGroupName + '\"]');\n\n      if (currentGroupName !== undefined) {\n        this.groupName = currentGroupName;\n        this.getImageGroup(groupList, imgSrc);\n      } else {\n        this.getImageGroup(jqEl.not('[data-group]'), imgSrc);\n      }\n\n      this.open();\n      this.loadImage(imgSrc); // Draggable & Movable & Resizable\n\n      if (opts.draggable) {\n        this.draggable(this.$magnify, this.dragHandle, '.magnify-button');\n      }\n\n      if (opts.movable) {\n        this.movable(this.$stage, isIE8() ? '.magnify-image' : this.$image);\n      }\n\n      if (opts.resizable) {\n        this.resizable(this.$magnify, this.$stage, isIE8() ? '.magnify-image' : this.$image, opts.modalWidth, opts.modalHeight);\n      }\n    },\n    _createBtns: function (toolbar) {\n      var self = this;\n      var btns = ['minimize', 'maximize', 'close', 'zoomIn', 'zoomOut', 'prev', 'next', 'fullscreen', 'actualSize', 'rotateLeft', 'rotateRight'];\n      var btnsHTML = '';\n      $.each(toolbar, function (index, item) {\n        if ($.inArray(item, btns) >= 0) {\n          btnsHTML += '<button class=\"magnify-button magnify-button-' + item + '\" title=\"' + self.options.i18n[item] + '\">' + self.options.icons[item] + '</button>';\n        } else if (self.options.customButtons[item]) {\n          btnsHTML += '<button class=\"magnify-button magnify-button-' + item + '\" title=\"' + (self.options.customButtons[item].title || '') + '\">' + self.options.customButtons[item].text + '</button>';\n        }\n      });\n      return btnsHTML;\n    },\n    _createTitle: function () {\n      return this.options.title ? '<div class=\"magnify-title\"></div>' : '';\n    },\n    _createTemplate: function () {\n      // Magnify base HTML\n      var magnifyHTML = '<div class=\"magnify-modal\" tabindex=\"0\">\\\n        <div class=\"magnify-header\">\\\n          <div class=\"magnify-toolbar\">' + this._createBtns(this.options.headerToolbar) + '\\\n          </div>' + this._createTitle() + '\\\n        </div>\\\n        <div class=\"magnify-stage\">\\\n          <img class=\"magnify-image\" src=\"\" alt=\"\" />\\\n        </div>\\\n        <div class=\"magnify-footer\">\\\n          <div class=\"magnify-toolbar\">' + this._createBtns(this.options.footerToolbar) + '\\\n          </div>\\\n        </div>\\\n      </div>';\n      return magnifyHTML;\n    },\n    build: function () {\n      // Create magnify HTML string\n      var magnifyHTML = this._createTemplate(); // Make magnify HTML string to jQuery element\n\n\n      var $magnify = $(magnifyHTML); // Get all magnify element\n\n      this.$magnify = $magnify;\n      this.$stage = $magnify.find('.magnify-stage');\n      this.$title = $magnify.find('.magnify-title');\n      this.$image = $magnify.find('.magnify-image');\n      this.$close = $magnify.find('.magnify-button-close');\n      this.$maximize = $magnify.find('.magnify-button-maximize');\n      this.$minimize = $magnify.find('.magnify-button-minimize');\n      this.$zoomIn = $magnify.find('.magnify-button-zoomIn');\n      this.$zoomOut = $magnify.find('.magnify-button-zoomOut');\n      this.$actualSize = $magnify.find('.magnify-button-actualSize');\n      this.$fullscreen = $magnify.find('.magnify-button-fullscreen');\n      this.$rotateLeft = $magnify.find('.magnify-button-rotateLeft');\n      this.$rotateRight = $magnify.find('.magnify-button-rotateRight');\n      this.$prev = $magnify.find('.magnify-button-prev');\n      this.$next = $magnify.find('.magnify-button-next'); // Add class before image loaded\n\n      this.$stage.addClass('stage-ready');\n      this.$image.addClass('image-ready'); // Reset modal z-index with multiple instances\n\n      this.$magnify.css('z-index', PUBLIC_VARS['zIndex']); // Set handle element of draggable\n\n      if (!this.options.dragHandle || this.options.dragHandle === '.magnify-modal') {\n        this.dragHandle = this.$magnify;\n      } else {\n        this.dragHandle = this.$magnify.find(this.options.dragHandle);\n      } // Add Magnify to DOM\n\n\n      $('body').append(this.$magnify);\n\n      this._addEvents();\n\n      this._addCustomButtonEvents();\n    },\n    open: function () {\n      this._triggerHook('beforeOpen', this);\n\n      if (!this.options.multiInstances) {\n        $('.magnify-modal').eq(0).remove();\n      } // Fixed modal position bug\n\n\n      if (!$('.magnify-modal').length && this.options.fixedContent) {\n        $('html').css({\n          overflow: 'hidden'\n        });\n\n        if (hasScrollbar()) {\n          var scrollbarWidth = getScrollbarWidth();\n\n          if (scrollbarWidth) {\n            $('html').css({\n              'padding-right': scrollbarWidth\n            });\n          }\n        }\n      }\n\n      this.build();\n      this.setModalPos(this.$magnify);\n      this.$magnify.focus();\n\n      this._triggerHook('opened', this);\n    },\n    close: function (el) {\n      this._triggerHook('beforeClose', this); // Remove instance\n\n\n      this.$magnify.remove();\n      this.isOpened = false;\n      this.isMaximized = false;\n      this.isRotated = false;\n      this.rotateAngle = 0;\n\n      if (!$('.magnify-modal').length) {\n        // Fixed modal position bug\n        if (this.options.fixedContent) {\n          $('html').css({\n            overflow: '',\n            'padding-right': ''\n          });\n        } // Reset zIndex after close\n\n\n        if (this.options.multiInstances) {\n          PUBLIC_VARS['zIndex'] = this.options.zIndex;\n        } // off resize events\n\n\n        $W.off(RESIZE_EVENT + EVENT_NS);\n      }\n\n      this._triggerHook('closed', this);\n    },\n    setModalPos: function (modal) {\n      var winWidth = $W.width(),\n          winHeight = $W.height(),\n          scrollLeft = $D.scrollLeft(),\n          scrollTop = $D.scrollTop();\n      var modalWidth = this.options.modalWidth,\n          modalHeight = this.options.modalHeight; // Set modal maximized when init\n\n      if (this.options.initMaximized) {\n        modal.addClass('magnify-maximize');\n        modal.css({\n          width: '100%',\n          height: '100%',\n          left: 0,\n          top: 0\n        });\n        this.isOpened = true;\n        this.isMaximized = true;\n      } else {\n        // Make the modal in windows center\n        modal.css({\n          width: modalWidth,\n          height: modalHeight,\n          left: (winWidth - modalWidth) / 2 + scrollLeft + 'px',\n          top: (winHeight - modalHeight) / 2 + scrollTop + 'px'\n        });\n      }\n    },\n    setModalSize: function (img) {\n      var self = this,\n          winWidth = $W.width(),\n          winHeight = $W.height(),\n          scrollLeft = $D.scrollLeft(),\n          scrollTop = $D.scrollTop(); // Stage css value\n\n      var stageCSS = {\n        left: this.$stage.css('left'),\n        right: this.$stage.css('right'),\n        top: this.$stage.css('top'),\n        bottom: this.$stage.css('bottom'),\n        borderLeft: this.$stage.css('border-left-width'),\n        borderRight: this.$stage.css('border-right-width'),\n        borderTop: this.$stage.css('border-top-width'),\n        borderBottom: this.$stage.css('border-bottom-width')\n      }; // Modal size should calc with stage css value\n\n      var modalWidth = img.width + parseFloat(stageCSS.left) + parseFloat(stageCSS.right) + parseFloat(stageCSS.borderLeft) + parseFloat(stageCSS.borderRight);\n      var modalHeight = img.height + parseFloat(stageCSS.top) + parseFloat(stageCSS.bottom) + parseFloat(stageCSS.borderTop) + parseFloat(stageCSS.borderBottom);\n      var gapThreshold = (this.options.gapThreshold > 0 ? this.options.gapThreshold : 0) + 1; // Modal scale to window\n\n      var scale = Math.min(winWidth / (modalWidth * gapThreshold), winHeight / (modalHeight * gapThreshold), 1);\n      var minWidth = Math.max(modalWidth * scale, this.options.modalWidth);\n      var minHeight = Math.max(modalHeight * scale, this.options.modalHeight);\n      minWidth = this.options.fixedModalSize ? this.options.modalWidth : Math.round(minWidth);\n      minHeight = this.options.fixedModalSize ? this.options.modalHeight : Math.round(minHeight);\n      var modalCSSObj = {\n        width: minWidth + 'px',\n        height: minHeight + 'px',\n        left: (winWidth - minWidth) / 2 + scrollLeft + 'px',\n        top: (winHeight - minHeight) / 2 + scrollTop + 'px'\n      }; // Add modal init animation\n\n      if (this.options.initAnimation) {\n        this.$magnify.animate(modalCSSObj, function () {\n          self.setImageSize(img);\n        });\n      } else {\n        this.$magnify.css(modalCSSObj);\n        this.setImageSize(img);\n      }\n\n      this.isOpened = true;\n    },\n    getImageScaleToStage: function (stageWidth, stageHeight) {\n      var scale = 1;\n\n      if (!this.isRotated) {\n        scale = Math.min(stageWidth / this.img.width, stageHeight / this.img.height, 1);\n      } else {\n        scale = Math.min(stageWidth / this.img.height, stageHeight / this.img.width, 1);\n      }\n\n      return scale;\n    },\n    setImageSize: function (img) {\n      var $image = isIE8() ? this.$stage.find('.magnify-image') : this.$image;\n      var stageData = {\n        w: this.$stage.width(),\n        h: this.$stage.height()\n      };\n      var scale = this.getImageScaleToStage(stageData.w, stageData.h);\n      $image.css({\n        width: Math.ceil(img.width * scale) + 'px',\n        height: Math.ceil(img.height * scale) + 'px',\n        left: (stageData.w - Math.ceil(img.width * scale)) / 2 + 'px',\n        top: (stageData.h - Math.ceil(img.height * scale)) / 2 + 'px'\n      });\n\n      if (isIE8()) {\n        $image.find('group').css({\n          width: Math.floor(img.width * scale) + 'px',\n          height: Math.floor(img.height * scale) + 'px'\n        });\n      } // Store image initial data\n\n\n      $.extend(this.imageData, {\n        initWidth: img.width * scale,\n        initHeight: img.height * scale,\n        initLeft: (stageData.w - img.width * scale) / 2,\n        initTop: (stageData.h - img.height * scale) / 2,\n        width: img.width * scale,\n        height: img.height * scale,\n        left: (stageData.w - img.width * scale) / 2,\n        top: (stageData.h - img.height * scale) / 2\n      }); // Set grab cursor\n\n      setGrabCursor({\n        w: $image.width(),\n        h: $image.height()\n      }, {\n        w: this.$stage.width(),\n        h: this.$stage.height()\n      }, this.$stage, this.isRotated); // Just execute before image loaded\n\n      if (!this.imageLoaded) {\n        // loader end\n        this.$magnify.find('.magnify-loader').remove(); // Remove class must when image setting end\n\n        this.$stage.removeClass('stage-ready');\n        this.$image.removeClass('image-ready'); // Add image init animation\n\n        if (this.options.initAnimation && !this.options.progressiveLoading) {\n          $image.fadeIn();\n        }\n\n        this.imageLoaded = true;\n      }\n    },\n    loadImage: function (imgSrc, fn, err) {\n      var self = this; // Reset image\n\n      this.$image.removeAttr('style').attr('src', '');\n      this.isRotated = false;\n      this.rotateAngle = 0;\n      this.imageLoaded = false; // Loader start\n\n      this.$magnify.append('<div class=\"magnify-loader\"></div>'); // Add class before image loaded\n\n      this.$stage.addClass('stage-ready');\n      this.$image.addClass('image-ready');\n\n      if (this.options.initAnimation && !this.options.progressiveLoading) {\n        this.$image.hide();\n      }\n\n      if (isIE8()) {\n        this.$stage.html('<img class=\"magnify-image\" id=\"magnify-image\" src=\"' + imgSrc + '\" alt=\"\" />');\n      } else {\n        this.$image.attr('src', imgSrc);\n      }\n\n      preloadImage(imgSrc, function (img) {\n        // Store HTMLImageElement\n        self.img = img; // Store original data\n\n        self.imageData = {\n          originalWidth: img.width,\n          originalHeight: img.height\n        };\n\n        if (self.isMaximized || self.isOpened && self.options.fixedModalPos) {\n          self.setImageSize(img);\n        } else {\n          self.setModalSize(img);\n        } // Callback of image loaded successfully\n\n\n        if (fn) {\n          fn.call();\n        }\n      }, function () {\n        // Loader end\n        self.$magnify.find('.magnify-loader').remove(); // Callback of image loading failed\n\n        if (err) {\n          err.call();\n        }\n      });\n\n      if (this.options.title) {\n        this.setImageTitle(imgSrc);\n      }\n    },\n    getImageGroup: function (list, imgSrc) {\n      var self = this;\n      self.groupData = [];\n      $(list).each(function (index, item) {\n        var _imgSrc = getImageSrc(this);\n\n        self.groupData.push({\n          src: _imgSrc,\n          caption: $(this).attr('data-caption')\n        }); // Get image index\n\n        if (imgSrc === _imgSrc) {\n          self.groupIndex = index;\n        }\n      });\n    },\n    setImageTitle: function (url) {\n      var title = this.groupData[this.groupIndex].caption || getImageNameFromUrl(url);\n      this.$title.html(title);\n    },\n    jump: function (step) {\n      this._triggerHook('beforeChange', [this, this.groupIndex]);\n\n      this.groupIndex = this.groupIndex + step;\n      this.jumpTo(this.groupIndex);\n    },\n    jumpTo: function (index) {\n      var self = this;\n      index = index % this.groupData.length;\n\n      if (index >= 0) {\n        index = index % this.groupData.length;\n      } else if (index < 0) {\n        index = (this.groupData.length + index) % this.groupData.length;\n      }\n\n      this.groupIndex = index;\n      this.loadImage(this.groupData[index].src, function () {\n        self._triggerHook('changed', [self, index]);\n      }, function () {\n        self._triggerHook('changed', [self, index]);\n      });\n    },\n    wheel: function (e) {\n      e.preventDefault();\n      var delta = 1;\n\n      if (e.originalEvent.deltaY) {\n        delta = e.originalEvent.deltaY > 0 ? 1 : -1;\n      } else if (e.originalEvent.wheelDelta) {\n        delta = -e.originalEvent.wheelDelta / 120;\n      } else if (e.originalEvent.detail) {\n        delta = e.originalEvent.detail > 0 ? 1 : -1;\n      } // Ratio threshold\n\n\n      var ratio = -delta * this.options.ratioThreshold; // Mouse point position relative to stage\n\n      var pointer = {\n        x: e.originalEvent.clientX - this.$stage.offset().left + $D.scrollLeft(),\n        y: e.originalEvent.clientY - this.$stage.offset().top + $D.scrollTop()\n      };\n      this.zoom(ratio, pointer, e);\n    },\n    zoom: function (ratio, origin, e) {\n      this.$image = isIE8() ? this.$stage.find('.magnify-image') : this.$image; // Zoom out ratio & Zoom in ratio\n\n      ratio = ratio < 0 ? 1 / (1 - ratio) : 1 + ratio; // Image ratio\n\n      ratio = this.$image.width() / this.imageData.originalWidth * ratio; // Fixed digital error\n      // if (ratio > 0.95 && ratio < 1.05) {\n      //   ratio = 1;\n      // }\n\n      if (ratio > this.options.maxRatio || ratio < this.options.minRatio) {\n        return;\n      }\n\n      this.zoomTo(ratio, origin, e);\n    },\n    zoomTo: function (ratio, origin, e) {\n      var $image = isIE8() ? this.$stage.find('.magnify-image') : this.$image;\n      var $stage = this.$stage;\n      var imgData = {\n        w: this.imageData.width,\n        h: this.imageData.height,\n        x: this.imageData.left,\n        y: this.imageData.top\n      }; // Image stage position\n      // We will use it to calc the relative position of image\n\n      var stageData = {\n        w: $stage.width(),\n        h: $stage.height(),\n        x: $stage.offset().left,\n        y: $stage.offset().top\n      };\n      var newWidth = this.imageData.originalWidth * ratio;\n      var newHeight = this.imageData.originalHeight * ratio; // Think about it for a while\n\n      var newLeft = origin.x - (origin.x - imgData.x) / imgData.w * newWidth;\n      var newTop = origin.y - (origin.y - imgData.y) / imgData.h * newHeight; // δ is the difference between image new width and new height\n\n      var δ = !this.isRotated ? 0 : (newWidth - newHeight) / 2;\n      var imgNewWidth = !this.isRotated ? newWidth : newHeight;\n      var imgNewHeight = !this.isRotated ? newHeight : newWidth;\n      var offsetX = stageData.w - newWidth,\n          offsetY = stageData.h - newHeight; // Zoom out & Zoom in condition\n      // It's important and it takes me a lot of time to get it\n      // The conditions with image rotate 90 degree drive me crazy alomst!\n\n      if (imgNewHeight <= stageData.h) {\n        newTop = (stageData.h - newHeight) / 2;\n      } else {\n        newTop = newTop > δ ? δ : newTop > offsetY - δ ? newTop : offsetY - δ;\n      }\n\n      if (imgNewWidth <= stageData.w) {\n        newLeft = (stageData.w - newWidth) / 2;\n      } else {\n        newLeft = newLeft > -δ ? -δ : newLeft > offsetX + δ ? newLeft : offsetX + δ;\n      } // If the image scale get to the critical point\n\n\n      if (Math.abs(this.imageData.initWidth - newWidth) < this.imageData.initWidth * 0.05) {\n        this.setImageSize(this.img);\n      } else {\n        $image.css({\n          width: Math.round(newWidth) + 'px',\n          height: Math.round(newHeight) + 'px',\n          left: Math.round(newLeft) + 'px',\n          top: Math.round(newTop) + 'px'\n        });\n\n        if (isIE8()) {\n          $image.find('group').css({\n            width: Math.ceil(newWidth) + 'px',\n            height: Math.ceil(newHeight) + 'px'\n          });\n        } // Set grab cursor\n\n\n        setGrabCursor({\n          w: Math.round(imgNewWidth),\n          h: Math.round(imgNewHeight)\n        }, {\n          w: stageData.w,\n          h: stageData.h\n        }, this.$stage);\n      } // Update image initial data\n\n\n      $.extend(this.imageData, {\n        width: newWidth,\n        height: newHeight,\n        left: newLeft,\n        top: newTop\n      });\n    },\n    rotate: function (angle) {\n      this.rotateAngle = this.rotateAngle + angle;\n\n      if (this.rotateAngle / 90 % 2 === 0) {\n        this.isRotated = false;\n      } else {\n        this.isRotated = true;\n      }\n\n      this.rotateTo(this.rotateAngle);\n    },\n    rotateTo: function (angle) {\n      var $image = isIE8() ? this.$stage.find('.magnify-image') : this.$image; // Depend on jQueryRotate.js\n\n      $image.rotate({\n        angle: angle\n      });\n      this.setImageSize({\n        width: this.imageData.originalWidth,\n        height: this.imageData.originalHeight\n      }); // Remove grab cursor when rotate\n\n      this.$stage.removeClass('is-grab');\n    },\n    resize: function () {\n      var self = this;\n      var resizeHandler = throttle(function () {\n        if (self.isOpened) {\n          if (self.isMaximized) {\n            self.setImageSize({\n              width: self.imageData.originalWidth,\n              height: self.imageData.originalHeight\n            });\n          } else {\n            self.setModalSize({\n              width: self.imageData.originalWidth,\n              height: self.imageData.originalHeight\n            });\n          }\n        }\n      }, 500);\n      return resizeHandler;\n    },\n    maximize: function () {\n      this.$magnify.focus();\n\n      if (!this.isMaximized) {\n        // Store modal data before maximize\n        this.modalData = {\n          width: this.$magnify.width(),\n          height: this.$magnify.height(),\n          left: this.$magnify.offset().left,\n          top: this.$magnify.offset().top\n        };\n        this.$magnify.addClass('magnify-maximize');\n        this.$magnify.css({\n          width: '100%',\n          height: '100%',\n          left: 0,\n          top: 0\n        });\n        this.isMaximized = true;\n      } else {\n        this.$magnify.removeClass('magnify-maximize');\n        var initModalLeft = ($W.width() - this.options.modalWidth) / 2 + $D.scrollLeft();\n        var initModalTop = ($W.height() - this.options.modalHeight) / 2 + $D.scrollTop();\n        this.$magnify.css({\n          width: this.modalData.width ? this.modalData.width : this.options.modalWidth,\n          height: this.modalData.height ? this.modalData.height : this.options.modalHeight,\n          left: this.modalData.left ? this.modalData.left : initModalLeft,\n          top: this.modalData.top ? this.modalData.top : initModalTop\n        });\n        this.isMaximized = false;\n      }\n\n      this.setImageSize({\n        width: this.imageData.originalWidth,\n        height: this.imageData.originalHeight\n      });\n    },\n    fullscreen: function () {\n      this.$magnify.focus();\n      requestFullscreen(this.$magnify[0]);\n    },\n    _keydown: function (e) {\n      var self = this;\n\n      if (!this.options.keyboard) {\n        return false;\n      }\n\n      var keyCode = e.keyCode || e.which || e.charCode,\n          ctrlKey = e.ctrlKey || e.metaKey,\n          altKey = e.altKey || e.metaKey;\n\n      switch (keyCode) {\n        // ←\n        case 37:\n          self.jump(-1);\n          break;\n        // →\n\n        case 39:\n          self.jump(1);\n          break;\n        // +\n\n        case 187:\n          self.zoom(self.options.ratioThreshold * 3, {\n            x: self.$stage.width() / 2,\n            y: self.$stage.height() / 2\n          }, e);\n          break;\n        // -\n\n        case 189:\n          self.zoom(-self.options.ratioThreshold * 3, {\n            x: self.$stage.width() / 2,\n            y: self.$stage.height() / 2\n          }, e);\n          break;\n        // + Firefox\n\n        case 61:\n          self.zoom(self.options.ratioThreshold * 3, {\n            x: self.$stage.width() / 2,\n            y: self.$stage.height() / 2\n          }, e);\n          break;\n        // - Firefox\n\n        case 173:\n          self.zoom(-self.options.ratioThreshold * 3, {\n            x: self.$stage.width() / 2,\n            y: self.$stage.height() / 2\n          }, e);\n          break;\n        // Ctrl + Alt + 0\n\n        case 48:\n          if (ctrlKey && altKey) {\n            self.zoomTo(1, {\n              x: self.$stage.width() / 2,\n              y: self.$stage.height() / 2\n            }, e);\n          }\n\n          break;\n        // Ctrl + ,\n\n        case 188:\n          if (ctrlKey) {\n            self.rotate(-90);\n          }\n\n          break;\n        // Ctrl + .\n\n        case 190:\n          if (ctrlKey) {\n            self.rotate(90);\n          }\n\n          break;\n        // Q\n\n        case 81:\n          this.close();\n          break;\n\n        default:\n      }\n    },\n    _addEvents: function () {\n      var self = this;\n      this.$close.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n        self.close();\n      });\n      this.$stage.off(WHEEL_EVENT + EVENT_NS).on(WHEEL_EVENT + EVENT_NS, function (e) {\n        self.wheel(e);\n      });\n      this.$zoomIn.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n        self.zoom(self.options.ratioThreshold * 3, {\n          x: self.$stage.width() / 2,\n          y: self.$stage.height() / 2\n        }, e);\n      });\n      this.$zoomOut.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n        self.zoom(-self.options.ratioThreshold * 3, {\n          x: self.$stage.width() / 2,\n          y: self.$stage.height() / 2\n        }, e);\n      });\n      this.$actualSize.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n        self.zoomTo(1, {\n          x: self.$stage.width() / 2,\n          y: self.$stage.height() / 2\n        }, e);\n      });\n      this.$prev.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n        self.jump(-1);\n      });\n      this.$fullscreen.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n        self.fullscreen();\n      });\n      this.$next.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n        self.jump(1);\n      });\n      this.$rotateLeft.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n        self.rotate(-90);\n      });\n      this.$rotateRight.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n        self.rotate(90);\n      });\n      this.$maximize.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n        self.maximize();\n      });\n      this.$magnify.off(KEYDOWN_EVENT + EVENT_NS).on(KEYDOWN_EVENT + EVENT_NS, function (e) {\n        self._keydown(e);\n      });\n      $W.on(RESIZE_EVENT + EVENT_NS, self.resize());\n    },\n    _addCustomButtonEvents: function () {\n      var self = this;\n\n      for (var btnKey in self.options.customButtons) {\n        this.$magnify.find('.magnify-button-' + btnKey).off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n          self.options.customButtons[btnKey].click.apply(self, [self, e]);\n        });\n      }\n    },\n    _triggerHook: function (e, data) {\n      if (this.options.callbacks[e]) {\n        this.options.callbacks[e].apply(this, $.isArray(data) ? data : [data]);\n      }\n    }\n  };\n  /**\n   * jQuery plugin\n   */\n\n  $.fn.magnify = function (options) {\n    jqEl = $(this); // Convert a numeric string into a number\n\n    for (var key in options) {\n      if (typeof options[key] === 'string' && !isNaN(options[key])) {\n        options[key] = parseFloat(options[key]);\n      }\n    } // Get init event, 'click' or 'dblclick'\n\n\n    var opts = $.extend(true, {}, DEFAULTS, options); // We should get zIndex of options before plugin's init.\n\n    PUBLIC_VARS['zIndex'] = opts.zIndex;\n\n    if (typeof options === 'string') {// $(this).data('magnify')[options]();\n    } else {\n      if (opts.initEvent === 'dblclick') {\n        jqEl.off('click' + EVENT_NS).on('click' + EVENT_NS, function (e) {\n          e.preventDefault(); // This will stop triggering data-api event\n\n          e.stopPropagation();\n        });\n      }\n\n      jqEl.off(opts.initEvent + EVENT_NS).on(opts.initEvent + EVENT_NS, function (e) {\n        e.preventDefault(); // This will stop triggering data-api event\n\n        e.stopPropagation();\n        $(this).data('magnify', new Magnify(this, options));\n      });\n    }\n\n    return jqEl;\n  };\n  /**\n   * MAGNIFY DATA-API\n   */\n\n\n  $D.on(CLICK_EVENT + EVENT_NS, '[data-magnify]', function (e) {\n    jqEl = $('[data-magnify]');\n    e.preventDefault();\n    $(this).data('magnify', new Magnify(this, DEFAULTS));\n  });\n  /**\n   * Draggable\n   * @param {Object} modal - The modal element\n   * @param {Object} dragHandle - The handle element when dragging\n   * @param {Object} dragCancel - The cancel element when dragging\n   */\n\n  var draggable = function (modal, dragHandle, dragCancel) {\n    var self = this;\n    var isDragging = false;\n    var startX = 0,\n        startY = 0,\n        left = 0,\n        top = 0;\n\n    var dragStart = function (e) {\n      e = e || window.event; // Must be removed\n      // e.preventDefault();\n\n      modal.focus(); // Get clicked button\n\n      var elemCancel = $(e.target).closest(dragCancel); // Stop modal moving when click buttons\n\n      if (elemCancel.length) {\n        return true;\n      }\n\n      if (self.options.multiInstances) {\n        modal.css('z-index', ++PUBLIC_VARS['zIndex']);\n      }\n\n      isDragging = true;\n      startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n      left = $(modal).offset().left;\n      top = $(modal).offset().top;\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n    };\n\n    var dragMove = function (e) {\n      e = e || window.event;\n      e.preventDefault();\n\n      if (isDragging && !PUBLIC_VARS['isMoving'] && !PUBLIC_VARS['isResizing'] && !self.isMaximized) {\n        var endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n        var endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n        var relativeX = endX - startX;\n        var relativeY = endY - startY;\n        $(modal).css({\n          left: relativeX + left + 'px',\n          top: relativeY + top + 'px'\n        });\n      }\n    };\n\n    var dragEnd = function (e) {\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).off(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n      isDragging = false;\n    };\n\n    $(dragHandle).on(TOUCH_START_EVENT + EVENT_NS, dragStart);\n  }; // Add to Magnify Prototype\n\n\n  $.extend(Magnify.prototype, {\n    draggable: draggable\n  });\n  /**\n   * --------------------------------------------------------------------------\n   * 1. No movable\n   * 2. Vertical movable\n   * 3. Horizontal movable\n   * 4. Vertical & Horizontal movable\n   * --------------------------------------------------------------------------\n   *\n   * Image movable\n   * @param {Object} stage - The stage element\n   * @param {Object} image - The image element\n   */\n\n  var movable = function (stage, image) {\n    var self = this;\n    var isDragging = false;\n    var startX = 0,\n        startY = 0,\n        left = 0,\n        top = 0,\n        widthDiff = 0,\n        heightDiff = 0,\n        δ = 0;\n\n    var dragStart = function (e) {\n      e = e || window.event;\n      e.preventDefault();\n      var $image = isIE8() ? $(stage).find(image) : $(image);\n      var imageWidth = $image.width(),\n          imageHeight = $image.height(),\n          stageWidth = $(stage).width(),\n          stageHeight = $(stage).height();\n      startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY; // δ is the difference between image width and height\n\n      δ = !self.isRotated ? 0 : (imageWidth - imageHeight) / 2; // Width or height difference can be use to limit image right or top position\n\n      widthDiff = !self.isRotated ? imageWidth - stageWidth : imageHeight - stageWidth;\n      heightDiff = !self.isRotated ? imageHeight - stageHeight : imageWidth - stageHeight; // Modal can be dragging if image is smaller to stage\n\n      isDragging = widthDiff > 0 || heightDiff > 0 ? true : false;\n      PUBLIC_VARS['isMoving'] = widthDiff > 0 || heightDiff > 0 ? true : false; // Reclac the element position when mousedown\n      // Fixed the issue of stage with a border\n\n      left = $image.position().left - (isIE8() ? 0 : δ);\n      top = $image.position().top + (isIE8() ? 0 : δ); // Add grabbing cursor\n\n      if (stage.hasClass('is-grab')) {\n        $('html, body, .magnify-modal, .magnify-stage, .magnify-button, .magnify-resizable-handle').addClass('is-grabbing');\n      }\n\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n    };\n\n    var dragMove = function (e) {\n      e = e || window.event;\n      e.preventDefault();\n      var $image = isIE8() ? $(stage).find(image) : $(image);\n\n      if (isDragging) {\n        var endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n        var endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n        var relativeX = endX - startX;\n        var relativeY = endY - startY;\n        var newLeft = relativeX + left;\n        var newTop = relativeY + top; // Vertical limit\n\n        if (heightDiff > 0) {\n          if (relativeY + top > δ) {\n            newTop = δ;\n          } else if (relativeY + top < -heightDiff + δ) {\n            newTop = -heightDiff + δ;\n          }\n        } else {\n          newTop = top;\n        } // Horizontal limit\n\n\n        if (widthDiff > 0) {\n          if (relativeX + left > -δ) {\n            newLeft = -δ;\n          } else if (relativeX + left < -widthDiff - δ) {\n            newLeft = -widthDiff - δ;\n          }\n        } else {\n          newLeft = left;\n        }\n\n        $image.css({\n          left: newLeft + 'px',\n          top: newTop + 'px'\n        }); // Update image initial data\n\n        $.extend(self.imageData, {\n          left: newLeft,\n          top: newTop\n        });\n      }\n    };\n\n    var dragEnd = function (e) {\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).off(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n      isDragging = false;\n      PUBLIC_VARS['isMoving'] = false; // Remove grabbing cursor\n\n      $('html, body, .magnify-modal, .magnify-stage, .magnify-button, .magnify-resizable-handle').removeClass('is-grabbing');\n    };\n\n    $(stage).on(TOUCH_START_EVENT + EVENT_NS, dragStart);\n  }; // Add to Magnify Prototype\n\n\n  $.extend(Magnify.prototype, {\n    movable: movable\n  });\n  /**\n   * --------------------------------------------------------------------------\n   * 1. Modal resizable\n   * 2. Keep image in stage center\n   * 3. Other image limitations\n   * --------------------------------------------------------------------------\n   *\n   * Resizable\n   * @param {Object} modal - The modal element\n   * @param {Object} stage - The stage element\n   * @param {Object} image - The image element\n   * @param {Number} minWidth - The option of modalWidth\n   * @param {Number} minHeight - The option of modalHeight\n   */\n\n  var resizable = function (modal, stage, image, minWidth, minHeight) {\n    var self = this;\n    var resizableHandleE = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-e\"></div>'),\n        resizableHandleW = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-w\"></div>'),\n        resizableHandleS = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-s\"></div>'),\n        resizableHandleN = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-n\"></div>'),\n        resizableHandleSE = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-se\"></div>'),\n        resizableHandleSW = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-sw\"></div>'),\n        resizableHandleNE = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-ne\"></div>'),\n        resizableHandleNW = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-nw\"></div>');\n    var resizableHandles = {\n      e: resizableHandleE,\n      w: resizableHandleW,\n      s: resizableHandleS,\n      n: resizableHandleN,\n      se: resizableHandleSE,\n      sw: resizableHandleSW,\n      ne: resizableHandleNE,\n      nw: resizableHandleNW\n    };\n    $(modal).append(resizableHandleE, resizableHandleW, resizableHandleS, resizableHandleN, resizableHandleSE, resizableHandleSW, resizableHandleNE, resizableHandleNW);\n    var isDragging = false;\n    var startX = 0,\n        startY = 0,\n        modalData = {\n      w: 0,\n      h: 0,\n      l: 0,\n      t: 0\n    },\n        stageData = {\n      w: 0,\n      h: 0,\n      l: 0,\n      t: 0\n    },\n        imageData = {\n      w: 0,\n      h: 0,\n      l: 0,\n      t: 0\n    }; // δ is the difference between image width and height\n\n    var δ = 0,\n        imgWidth = 0,\n        imgHeight = 0,\n        direction = ''; // Modal CSS options\n\n    var getModalOpts = function (dir, offsetX, offsetY) {\n      // Modal should not move when its width to the minwidth\n      var modalLeft = -offsetX + modalData.w > minWidth ? offsetX + modalData.l : modalData.l + modalData.w - minWidth;\n      var modalTop = -offsetY + modalData.h > minHeight ? offsetY + modalData.t : modalData.t + modalData.h - minHeight;\n      var opts = {\n        e: {\n          width: Math.max(offsetX + modalData.w, minWidth) + 'px'\n        },\n        s: {\n          height: Math.max(offsetY + modalData.h, minHeight) + 'px'\n        },\n        se: {\n          width: Math.max(offsetX + modalData.w, minWidth) + 'px',\n          height: Math.max(offsetY + modalData.h, minHeight) + 'px'\n        },\n        w: {\n          width: Math.max(-offsetX + modalData.w, minWidth) + 'px',\n          left: modalLeft + 'px'\n        },\n        n: {\n          height: Math.max(-offsetY + modalData.h, minHeight) + 'px',\n          top: modalTop + 'px'\n        },\n        nw: {\n          width: Math.max(-offsetX + modalData.w, minWidth) + 'px',\n          height: Math.max(-offsetY + modalData.h, minHeight) + 'px',\n          top: modalTop + 'px',\n          left: modalLeft + 'px'\n        },\n        ne: {\n          width: Math.max(offsetX + modalData.w, minWidth) + 'px',\n          height: Math.max(-offsetY + modalData.h, minHeight) + 'px',\n          top: modalTop + 'px'\n        },\n        sw: {\n          width: Math.max(-offsetX + modalData.w, minWidth) + 'px',\n          height: Math.max(offsetY + modalData.h, minHeight) + 'px',\n          left: modalLeft + 'px'\n        }\n      };\n      return opts[dir];\n    }; // Image CSS options\n\n\n    var getImageOpts = function (dir, offsetX, offsetY) {\n      var $image = isIE8() ? $(stage).find(image) : $(image); // In modern browser, the width and height of image won't change after rotated.\n      // But its position top and left will get values from the image rotated.\n      // In IE8 browser, due to the type of rotating, all the value will be the same.\n\n      var imgPosLeft = isIE8() ? $image.position().left + δ : $image.position().left;\n      var imgPosTop = isIE8() ? $image.position().top - δ : $image.position().top; // Image should not move when modal width to the min width\n      // The minwidth is modal width, so we should clac the stage minwidth\n\n      var widthDiff = offsetX + modalData.w > minWidth ? stageData.w - imgWidth + offsetX - δ : minWidth - (modalData.w - stageData.w) - imgWidth - δ;\n      var heightDiff = offsetY + modalData.h > minHeight ? stageData.h - imgHeight + offsetY + δ : minHeight - (modalData.h - stageData.h) - imgHeight + δ;\n      var widthDiff2 = -offsetX + modalData.w > minWidth ? stageData.w - imgWidth - offsetX - δ : minWidth - (modalData.w - stageData.w) - imgWidth - δ;\n      var heightDiff2 = -offsetY + modalData.h > minHeight ? stageData.h - imgHeight - offsetY + δ : minHeight - (modalData.h - stageData.h) - imgHeight + δ; // Get image position in dragging\n\n      var imgLeft = (widthDiff > 0 ? imgPosLeft : imgPosLeft < 0 ? imgPosLeft : 0) - δ;\n      var imgTop = (heightDiff > 0 ? imgPosTop : imgPosTop < 0 ? imgPosTop : 0) + δ;\n      var imgLeft2 = (widthDiff2 > 0 ? imgPosLeft : imgPosLeft < 0 ? imgPosLeft : 0) - δ;\n      var imgTop2 = (heightDiff2 > 0 ? imgPosTop : imgPosTop < 0 ? imgPosTop : 0) + δ;\n      var opts = {\n        e: {\n          left: widthDiff >= -δ ? (widthDiff - δ) / 2 + 'px' : imgLeft > widthDiff ? imgLeft + 'px' : widthDiff + 'px'\n        },\n        s: {\n          top: heightDiff >= δ ? (heightDiff + δ) / 2 + 'px' : imgTop > heightDiff ? imgTop + 'px' : heightDiff + 'px'\n        },\n        se: {\n          top: heightDiff >= δ ? (heightDiff + δ) / 2 + 'px' : imgTop > heightDiff ? imgTop + 'px' : heightDiff + 'px',\n          left: widthDiff >= -δ ? (widthDiff - δ) / 2 + 'px' : imgLeft > widthDiff ? imgLeft + 'px' : widthDiff + 'px'\n        },\n        w: {\n          left: widthDiff2 >= -δ ? (widthDiff2 - δ) / 2 + 'px' : imgLeft2 > widthDiff2 ? imgLeft2 + 'px' : widthDiff2 + 'px'\n        },\n        n: {\n          top: heightDiff2 >= δ ? (heightDiff2 + δ) / 2 + 'px' : imgTop2 > heightDiff2 ? imgTop2 + 'px' : heightDiff2 + 'px'\n        },\n        nw: {\n          top: heightDiff2 >= δ ? (heightDiff2 + δ) / 2 + 'px' : imgTop2 > heightDiff2 ? imgTop2 + 'px' : heightDiff2 + 'px',\n          left: widthDiff2 >= -δ ? (widthDiff2 - δ) / 2 + 'px' : imgLeft2 > widthDiff2 ? imgLeft2 + 'px' : widthDiff2 + 'px'\n        },\n        ne: {\n          top: heightDiff2 >= δ ? (heightDiff2 + δ) / 2 + 'px' : imgTop2 > heightDiff2 ? imgTop2 + 'px' : heightDiff2 + 'px',\n          left: widthDiff >= -δ ? (widthDiff - δ) / 2 + 'px' : imgLeft > widthDiff ? imgLeft + 'px' : widthDiff + 'px'\n        },\n        sw: {\n          top: heightDiff >= δ ? (heightDiff + δ) / 2 + 'px' : imgTop > heightDiff ? imgTop + 'px' : heightDiff + 'px',\n          left: widthDiff2 >= -δ ? (widthDiff2 - δ) / 2 + 'px' : imgLeft2 > widthDiff2 ? imgLeft2 + 'px' : widthDiff2 + 'px'\n        }\n      };\n      return opts[dir];\n    };\n\n    var dragStart = function (dir, e) {\n      e = e || window.event;\n      e.preventDefault();\n      var $image = isIE8() ? $(stage).find(image) : $(image);\n      isDragging = true;\n      PUBLIC_VARS['isResizing'] = true;\n      startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY; // Reclac the modal data when mousedown\n\n      modalData = {\n        w: $(modal).width(),\n        h: $(modal).height(),\n        l: $(modal).offset().left,\n        t: $(modal).offset().top\n      };\n      stageData = {\n        w: $(stage).width(),\n        h: $(stage).height(),\n        l: $(stage).offset().left,\n        t: $(stage).offset().top\n      };\n      imageData = {\n        w: $image.width(),\n        h: $image.height(),\n        l: $image.position().left,\n        t: $image.position().top\n      }; // δ is the difference between image width and height\n\n      δ = !self.isRotated ? 0 : (imageData.w - imageData.h) / 2;\n      imgWidth = !self.isRotated ? imageData.w : imageData.h;\n      imgHeight = !self.isRotated ? imageData.h : imageData.w;\n      direction = dir; // Add resizable cursor\n\n      $('html,body,.magnify-modal,.magnify-stage,.magnify-button').css('cursor', dir + '-resize');\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\n    };\n\n    var dragMove = function (e) {\n      e = e || window.event;\n      e.preventDefault();\n      var $image = isIE8() ? $(stage).find(image) : $(image);\n\n      if (isDragging && !self.isMaximized) {\n        var endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n        var endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n        var relativeX = endX - startX;\n        var relativeY = endY - startY;\n        var modalOpts = getModalOpts(direction, relativeX, relativeY);\n        $(modal).css(modalOpts);\n        var imageOpts = getImageOpts(direction, relativeX, relativeY);\n        $image.css(imageOpts);\n        self.isDoResize = true;\n      }\n    };\n\n    var dragEnd = function (e) {\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).off(TOUCH_END_EVENT + EVENT_NS, dragEnd); // Set grab cursor\n\n      if (PUBLIC_VARS['isResizing']) {\n        setGrabCursor({\n          w: imgWidth,\n          h: imgHeight\n        }, {\n          w: $(stage).width(),\n          h: $(stage).height()\n        }, stage);\n      }\n\n      isDragging = false;\n      PUBLIC_VARS['isResizing'] = false; // Remove resizable cursor\n\n      $('html, body, .magnify-modal, .magnify-stage, .magnify-button').css('cursor', ''); // Update image initial data\n\n      var scale = self.getImageScaleToStage($(stage).width(), $(stage).height());\n      $.extend(self.imageData, {\n        initWidth: self.img.width * scale,\n        initHeight: self.img.height * scale,\n        initLeft: ($(stage).width() - self.img.width * scale) / 2,\n        initTop: ($(stage).height() - self.img.height * scale) / 2\n      });\n    };\n\n    $.each(resizableHandles, function (dir, handle) {\n      handle.on(TOUCH_START_EVENT + EVENT_NS, function (e) {\n        dragStart(dir, e);\n      });\n    });\n  }; // Add to Magnify Prototype\n\n\n  $.extend(Magnify.prototype, {\n    resizable: resizable\n  });\n}); // VERSION: 2.3 LAST UPDATE: 11.07.2013\n\n/*\n * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php\n *\n * Made by Wilq32, wilq32@gmail.com, Wroclaw, Poland, 01.2009\n * Website: http://jqueryrotate.com\n */\n\n\n(function ($) {\n  var supportedCSS,\n      supportedCSSOrigin,\n      styles = document.getElementsByTagName('head')[0].style,\n      toCheck = 'transformProperty WebkitTransform OTransform msTransform MozTransform'.split(' ');\n\n  for (var a = 0; a < toCheck.length; a++) if (styles[toCheck[a]] !== undefined) {\n    supportedCSS = toCheck[a];\n  }\n\n  if (supportedCSS) {\n    supportedCSSOrigin = supportedCSS.replace(/[tT]ransform/, 'TransformOrigin');\n    if (supportedCSSOrigin[0] == 'T') supportedCSSOrigin[0] = 't';\n  } // Bad eval to preven google closure to remove it from code o_O\n\n\n  eval('IE = \"v\"==\"\\v\"');\n  jQuery.fn.extend({\n    rotate: function (parameters) {\n      if (this.length === 0 || typeof parameters == 'undefined') return;\n      if (typeof parameters == 'number') parameters = {\n        angle: parameters\n      };\n      var returned = [];\n\n      for (var i = 0, i0 = this.length; i < i0; i++) {\n        var element = this.get(i);\n\n        if (!element.Wilq32 || !element.Wilq32.PhotoEffect) {\n          var paramClone = $.extend(true, {}, parameters);\n          var newRotObject = new Wilq32.PhotoEffect(element, paramClone)._rootObj;\n          returned.push($(newRotObject));\n        } else {\n          element.Wilq32.PhotoEffect._handleRotation(parameters);\n        }\n      }\n\n      return returned;\n    },\n    getRotateAngle: function () {\n      var ret = [0];\n\n      for (var i = 0, i0 = this.length; i < i0; i++) {\n        var element = this.get(i);\n\n        if (element.Wilq32 && element.Wilq32.PhotoEffect) {\n          ret[i] = element.Wilq32.PhotoEffect._angle;\n        }\n      }\n\n      return ret;\n    },\n    stopRotate: function () {\n      for (var i = 0, i0 = this.length; i < i0; i++) {\n        var element = this.get(i);\n\n        if (element.Wilq32 && element.Wilq32.PhotoEffect) {\n          clearTimeout(element.Wilq32.PhotoEffect._timer);\n        }\n      }\n    }\n  }); // Library agnostic interface\n\n  Wilq32 = window.Wilq32 || {};\n\n  Wilq32.PhotoEffect = function () {\n    if (supportedCSS) {\n      return function (img, parameters) {\n        img.Wilq32 = {\n          PhotoEffect: this\n        };\n        this._img = this._rootObj = this._eventObj = img;\n\n        this._handleRotation(parameters);\n      };\n    } else {\n      return function (img, parameters) {\n        this._img = img;\n        this._onLoadDelegate = [parameters];\n        this._rootObj = document.createElement('span');\n        this._rootObj.style.display = 'inline-block';\n        this._rootObj.Wilq32 = {\n          PhotoEffect: this\n        };\n        img.parentNode.insertBefore(this._rootObj, img);\n\n        if (img.complete) {\n          this._Loader();\n        } else {\n          var self = this; // TODO: Remove jQuery dependency\n\n          jQuery(this._img).bind('load', function () {\n            self._Loader();\n          });\n        }\n      };\n    }\n  }();\n\n  Wilq32.PhotoEffect.prototype = {\n    _setupParameters: function (parameters) {\n      this._parameters = this._parameters || {};\n\n      if (typeof this._angle !== 'number') {\n        this._angle = 0;\n      }\n\n      if (typeof parameters.angle === 'number') {\n        this._angle = parameters.angle;\n      }\n\n      this._parameters.animateTo = typeof parameters.animateTo === 'number' ? parameters.animateTo : this._angle;\n      this._parameters.step = parameters.step || this._parameters.step || null;\n      this._parameters.easing = parameters.easing || this._parameters.easing || this._defaultEasing;\n      this._parameters.duration = 'duration' in parameters ? parameters.duration : parameters.duration || this._parameters.duration || 1000;\n      this._parameters.callback = parameters.callback || this._parameters.callback || this._emptyFunction;\n      this._parameters.center = parameters.center || this._parameters.center || ['50%', '50%'];\n\n      if (typeof this._parameters.center[0] == 'string') {\n        this._rotationCenterX = parseInt(this._parameters.center[0], 10) / 100 * this._imgWidth * this._aspectW;\n      } else {\n        this._rotationCenterX = this._parameters.center[0];\n      }\n\n      if (typeof this._parameters.center[1] == 'string') {\n        this._rotationCenterY = parseInt(this._parameters.center[1], 10) / 100 * this._imgHeight * this._aspectH;\n      } else {\n        this._rotationCenterY = this._parameters.center[1];\n      }\n\n      if (parameters.bind && parameters.bind != this._parameters.bind) {\n        this._BindEvents(parameters.bind);\n      }\n    },\n    _emptyFunction: function () {},\n    _defaultEasing: function (x, t, b, c, d) {\n      return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n    },\n    _handleRotation: function (parameters, dontcheck) {\n      if (!supportedCSS && !this._img.complete && !dontcheck) {\n        this._onLoadDelegate.push(parameters);\n\n        return;\n      }\n\n      this._setupParameters(parameters);\n\n      if (this._angle == this._parameters.animateTo) {\n        this._rotate(this._angle);\n      } else {\n        this._animateStart();\n      }\n    },\n    _BindEvents: function (events) {\n      if (events && this._eventObj) {\n        // Unbinding previous Events\n        if (this._parameters.bind) {\n          var oldEvents = this._parameters.bind;\n\n          for (var a in oldEvents) if (oldEvents.hasOwnProperty(a)) // TODO: Remove jQuery dependency\n            jQuery(this._eventObj).unbind(a, oldEvents[a]);\n        }\n\n        this._parameters.bind = events;\n\n        for (var a in events) if (events.hasOwnProperty(a)) // TODO: Remove jQuery dependency\n          jQuery(this._eventObj).bind(a, events[a]);\n      }\n    },\n    _Loader: function () {\n      if (IE) return function () {\n        var width = this._img.width;\n        var height = this._img.height;\n        this._imgWidth = width;\n        this._imgHeight = height;\n\n        this._img.parentNode.removeChild(this._img);\n\n        this._vimage = this.createVMLNode('image');\n        this._vimage.src = this._img.src;\n        this._vimage.style.height = height + 'px';\n        this._vimage.style.width = width + 'px';\n        this._vimage.style.position = 'absolute'; // FIXES IE PROBLEM - its only rendered if its on absolute position!\n\n        this._vimage.style.top = '0px';\n        this._vimage.style.left = '0px';\n        this._aspectW = this._aspectH = 1;\n        /* Group minifying a small 1px precision problem when rotating object */\n\n        this._container = this.createVMLNode('group');\n        this._container.style.width = width;\n        this._container.style.height = height;\n        this._container.style.position = 'absolute';\n        this._container.style.top = '0px';\n        this._container.style.left = '0px';\n\n        this._container.setAttribute('coordsize', width - 1 + ',' + (height - 1)); // This -1, -1 trying to fix ugly problem with small displacement on IE\n\n\n        this._container.appendChild(this._vimage);\n\n        this._rootObj.appendChild(this._container);\n\n        this._rootObj.style.position = 'relative'; // FIXES IE PROBLEM\n\n        this._rootObj.style.width = width + 'px';\n        this._rootObj.style.height = height + 'px';\n\n        this._rootObj.setAttribute('id', this._img.getAttribute('id'));\n\n        this._rootObj.className = this._img.className;\n        this._eventObj = this._rootObj;\n        var parameters;\n\n        while (parameters = this._onLoadDelegate.shift()) {\n          this._handleRotation(parameters, true);\n        }\n      };else return function () {\n        this._rootObj.setAttribute('id', this._img.getAttribute('id'));\n\n        this._rootObj.className = this._img.className;\n        this._imgWidth = this._img.naturalWidth;\n        this._imgHeight = this._img.naturalHeight;\n\n        var _widthMax = Math.sqrt(this._imgHeight * this._imgHeight + this._imgWidth * this._imgWidth);\n\n        this._width = _widthMax * 3;\n        this._height = _widthMax * 3;\n        this._aspectW = this._img.offsetWidth / this._img.naturalWidth;\n        this._aspectH = this._img.offsetHeight / this._img.naturalHeight;\n\n        this._img.parentNode.removeChild(this._img);\n\n        this._canvas = document.createElement('canvas');\n\n        this._canvas.setAttribute('width', this._width);\n\n        this._canvas.style.position = 'relative';\n        this._canvas.style.left = -this._img.height * this._aspectW + 'px';\n        this._canvas.style.top = -this._img.width * this._aspectH + 'px';\n        this._canvas.Wilq32 = this._rootObj.Wilq32;\n\n        this._rootObj.appendChild(this._canvas);\n\n        this._rootObj.style.width = this._img.width * this._aspectW + 'px';\n        this._rootObj.style.height = this._img.height * this._aspectH + 'px';\n        this._eventObj = this._canvas;\n        this._cnv = this._canvas.getContext('2d');\n        var parameters;\n\n        while (parameters = this._onLoadDelegate.shift()) {\n          this._handleRotation(parameters, true);\n        }\n      };\n    }(),\n    _animateStart: function () {\n      if (this._timer) {\n        clearTimeout(this._timer);\n      }\n\n      this._animateStartTime = +new Date();\n      this._animateStartAngle = this._angle;\n\n      this._animate();\n    },\n    _animate: function () {\n      var actualTime = +new Date();\n      var checkEnd = actualTime - this._animateStartTime > this._parameters.duration; // TODO: Bug for animatedGif for static rotation ? (to test)\n\n      if (checkEnd && !this._parameters.animatedGif) {\n        clearTimeout(this._timer);\n      } else {\n        if (this._canvas || this._vimage || this._img) {\n          var angle = this._parameters.easing(0, actualTime - this._animateStartTime, this._animateStartAngle, this._parameters.animateTo - this._animateStartAngle, this._parameters.duration);\n\n          this._rotate(~~(angle * 10) / 10);\n        }\n\n        if (this._parameters.step) {\n          this._parameters.step(this._angle);\n        }\n\n        var self = this;\n        this._timer = setTimeout(function () {\n          self._animate.call(self);\n        }, 10);\n      } // To fix Bug that prevents using recursive function in callback I moved this function to back\n\n\n      if (this._parameters.callback && checkEnd) {\n        this._angle = this._parameters.animateTo;\n\n        this._rotate(this._angle);\n\n        this._parameters.callback.call(this._rootObj);\n      }\n    },\n    _rotate: function () {\n      var rad = Math.PI / 180;\n      if (IE) return function (angle) {\n        this._angle = angle;\n        this._container.style.rotation = angle % 360 + 'deg';\n        this._vimage.style.top = -(this._rotationCenterY - this._imgHeight / 2) + 'px';\n        this._vimage.style.left = -(this._rotationCenterX - this._imgWidth / 2) + 'px';\n        this._container.style.top = this._rotationCenterY - this._imgHeight / 2 + 'px';\n        this._container.style.left = this._rotationCenterX - this._imgWidth / 2 + 'px';\n      };else if (supportedCSS) return function (angle) {\n        this._angle = angle;\n        this._img.style[supportedCSS] = 'rotate(' + angle % 360 + 'deg)';\n        this._img.style[supportedCSSOrigin] = this._parameters.center.join(' ');\n      };else return function (angle) {\n        this._angle = angle;\n        angle = angle % 360 * rad; // clear canvas\n\n        this._canvas.width = this._width; //+this._widthAdd;\n\n        this._canvas.height = this._height; //+this._heightAdd;\n        // REMEMBER: all drawings are read from backwards.. so first function is translate, then rotate, then translate, translate..\n\n        this._cnv.translate(this._imgWidth * this._aspectW, this._imgHeight * this._aspectH); // at least center image on screen\n\n\n        this._cnv.translate(this._rotationCenterX, this._rotationCenterY); // we move image back to its orginal\n\n\n        this._cnv.rotate(angle); // rotate image\n\n\n        this._cnv.translate(-this._rotationCenterX, -this._rotationCenterY); // move image to its center, so we can rotate around its center\n\n\n        this._cnv.scale(this._aspectW, this._aspectH); // SCALE - if needed ;)\n\n\n        this._cnv.drawImage(this._img, 0, 0); // First - we draw image\n\n      };\n    }()\n  };\n\n  if (IE) {\n    Wilq32.PhotoEffect.prototype.createVMLNode = function () {\n      document.createStyleSheet().addRule('.rvml', 'behavior:url(#default#VML)');\n\n      try {\n        !document.namespaces.rvml && document.namespaces.add('rvml', 'urn:schemas-microsoft-com:vml');\n        return function (tagName) {\n          return document.createElement('<rvml:' + tagName + ' class=\"rvml\">');\n        };\n      } catch (e) {\n        return function (tagName) {\n          return document.createElement('<' + tagName + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"rvml\">');\n        };\n      }\n    }();\n  }\n})(jQuery);","map":{"version":3,"sources":["/Users/annllamb/Documents/GitHub/Intern-project/frontend/node_modules/jquery.magnify/dist/jquery.magnify.js"],"names":["factory","define","amd","exports","require","jQuery","$","getImageSrc","el","src","attr","throttle","fn","delay","timer","context","args","arguments","clearTimeout","setTimeout","apply","preloadImage","success","error","img","Image","onload","onerror","requestFullscreen","element","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","exitFullscreen","document","mozCancelFullScreen","webkitExitFullscreen","getImageNameFromUrl","url","reg","txt","replace","hasScrollbar","body","scrollHeight","window","innerHeight","documentElement","clientHeight","getScrollbarWidth","scrollDiv","createElement","style","cssText","appendChild","scrollbarWidth","offsetWidth","clientWidth","removeChild","setGrabCursor","imageData","stageData","stage","isRotated","imageWidth","w","h","imageHeight","addClass","removeClass","supportTouch","DocumentTouch","isIE8","navigator","appName","appVersion","indexOf","$W","$D","CLICK_EVENT","RESIZE_EVENT","KEYDOWN_EVENT","WHEEL_EVENT","TOUCH_START_EVENT","TOUCH_MOVE_EVENT","TOUCH_END_EVENT","NS","EVENT_NS","DEFAULTS","draggable","resizable","movable","keyboard","title","modalWidth","modalHeight","fixedContent","fixedModalSize","initMaximized","gapThreshold","ratioThreshold","minRatio","maxRatio","headerToolbar","footerToolbar","icons","minimize","maximize","close","zoomIn","zoomOut","prev","next","fullscreen","actualSize","rotateLeft","rotateRight","i18n","multiInstances","initEvent","initAnimation","fixedModalPos","zIndex","dragHandle","callbacks","beforeOpen","noop","opened","beforeClose","closed","beforeChange","changed","progressiveLoading","customButtons","PUBLIC_VARS","isMoving","isResizing","jqEl","Magnify","options","self","extend","isArray","$el","isOpened","isMaximized","rotateAngle","isDoResize","modalData","width","height","left","top","init","prototype","opts","imgSrc","groupName","currentGroupName","groupList","find","undefined","getImageGroup","not","open","loadImage","$magnify","$stage","$image","_createBtns","toolbar","btns","btnsHTML","each","index","item","inArray","text","_createTitle","_createTemplate","magnifyHTML","build","$title","$close","$maximize","$minimize","$zoomIn","$zoomOut","$actualSize","$fullscreen","$rotateLeft","$rotateRight","$prev","$next","css","append","_addEvents","_addCustomButtonEvents","_triggerHook","eq","remove","length","overflow","setModalPos","focus","off","modal","winWidth","winHeight","scrollLeft","scrollTop","setModalSize","stageCSS","right","bottom","borderLeft","borderRight","borderTop","borderBottom","parseFloat","scale","Math","min","minWidth","max","minHeight","round","modalCSSObj","animate","setImageSize","getImageScaleToStage","stageWidth","stageHeight","ceil","floor","initWidth","initHeight","initLeft","initTop","imageLoaded","fadeIn","err","removeAttr","hide","html","originalWidth","originalHeight","call","setImageTitle","list","groupData","_imgSrc","push","caption","groupIndex","jump","step","jumpTo","wheel","e","preventDefault","delta","originalEvent","deltaY","wheelDelta","detail","ratio","pointer","x","clientX","offset","y","clientY","zoom","origin","zoomTo","imgData","newWidth","newHeight","newLeft","newTop","δ","imgNewWidth","imgNewHeight","offsetX","offsetY","abs","rotate","angle","rotateTo","resize","resizeHandler","initModalLeft","initModalTop","_keydown","keyCode","which","charCode","ctrlKey","metaKey","altKey","on","btnKey","click","data","magnify","key","isNaN","stopPropagation","dragCancel","isDragging","startX","startY","dragStart","event","elemCancel","target","closest","type","targetTouches","pageX","pageY","dragMove","dragEnd","endX","endY","relativeX","relativeY","image","widthDiff","heightDiff","position","hasClass","resizableHandleE","resizableHandleW","resizableHandleS","resizableHandleN","resizableHandleSE","resizableHandleSW","resizableHandleNE","resizableHandleNW","resizableHandles","s","n","se","sw","ne","nw","l","t","imgWidth","imgHeight","direction","getModalOpts","dir","modalLeft","modalTop","getImageOpts","imgPosLeft","imgPosTop","widthDiff2","heightDiff2","imgLeft","imgTop","imgLeft2","imgTop2","modalOpts","imageOpts","handle","supportedCSS","supportedCSSOrigin","styles","getElementsByTagName","toCheck","split","a","eval","parameters","returned","i","i0","get","Wilq32","PhotoEffect","paramClone","newRotObject","_rootObj","_handleRotation","getRotateAngle","ret","_angle","stopRotate","_timer","_img","_eventObj","_onLoadDelegate","display","parentNode","insertBefore","complete","_Loader","bind","_setupParameters","_parameters","animateTo","easing","_defaultEasing","duration","callback","_emptyFunction","center","_rotationCenterX","parseInt","_imgWidth","_aspectW","_rotationCenterY","_imgHeight","_aspectH","_BindEvents","b","c","d","dontcheck","_rotate","_animateStart","events","oldEvents","hasOwnProperty","unbind","IE","_vimage","createVMLNode","_container","setAttribute","getAttribute","className","shift","naturalWidth","naturalHeight","_widthMax","sqrt","_width","_height","offsetHeight","_canvas","_cnv","getContext","_animateStartTime","Date","_animateStartAngle","_animate","actualTime","checkEnd","animatedGif","rad","PI","rotation","join","translate","drawImage","createStyleSheet","addRule","namespaces","rvml","add","tagName"],"mappings":"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A,eAbW;AAcLC,MAAAA,KAAK,EACH;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAxBW;AAyBLC,MAAAA,MAAM,EACJ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eArCW;AAsCLC,MAAAA,OAAO,EACL;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAhDW;AAiDLC,MAAAA,IAAI,EACF;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eA1DW;AA2DLC,MAAAA,IAAI,EACF;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eApEW;AAqELC,MAAAA,UAAU,EACR;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAhFW;AAiFLC,MAAAA,UAAU,EACR;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAjGW;AAkGLC,MAAAA,UAAU,EACR;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eA7GW;AA8GLC,MAAAA,WAAW,EACT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzHW,KA1CE;AAqKT;AACAC,IAAAA,IAAI,EAAE;AACJX,MAAAA,QAAQ,EAAE,UADN;AAEJC,MAAAA,QAAQ,EAAE,UAFN;AAGJC,MAAAA,KAAK,EAAE,OAHH;AAIJC,MAAAA,MAAM,EAAE,YAJJ;AAKJC,MAAAA,OAAO,EAAE,aALL;AAMJC,MAAAA,IAAI,EAAE,SANF;AAOJC,MAAAA,IAAI,EAAE,SAPF;AAQJC,MAAAA,UAAU,EAAE,YARR;AASJC,MAAAA,UAAU,EAAE,yBATR;AAUJC,MAAAA,UAAU,EAAE,qBAVR;AAWJC,MAAAA,WAAW,EAAE;AAXT,KAtKG;AAmLT;AACAE,IAAAA,cAAc,EAAE,IApLP;AAqLT;AACAC,IAAAA,SAAS,EAAE,OAtLF;AAuLT;AACAC,IAAAA,aAAa,EAAE,IAxLN;AAyLT;AACAC,IAAAA,aAAa,EAAE,KA1LN;AA2LT;AA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","sourcesContent":["/*!\n *  __  __    _    ____ _   _ ___ _______   __\n * |  \\/  |  / \\  / ___| \\ | |_ _|  ___\\ \\ / /\n * | |\\/| | / _ \\| |  _|  \\| || || |_   \\ V /\n * | |  | |/ ___ \\ |_| | |\\  || ||  _|   | |\n * |_|  |_/_/   \\_\\____|_| \\_|___|_|     |_|\n *\n * jquery.magnify - v1.6.3\n * A jQuery plugin to view images just like in windows\n * https://github.com/nzbin/magnify#readme\n *\n * Copyright (c) 2017 nzbin\n * Released under the MIT License\n */\n;\n(function(factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as anonymous module.\n    define(['jquery'], factory);\n  } else if (typeof exports === 'object') {\n    // Node / CommonJS\n    factory(require('jquery'));\n  } else {\n    // Browser globals.\n    factory(jQuery);\n  }\n})(function($) {\n\n  'use strict';\n\n/**\n * Private Functions\n */\n\n/**\n * Get image src from `data-src`\n * @param {Object} el - image\n */\nfunction getImageSrc(el) {\n  // Get data-src as image src at first\n  var src = $(el).attr('data-src') ? $(el).attr('data-src') : $(el).attr('href');\n  return src;\n}\n\n/**\n * Throttle function\n * @param {Function} fn - The function will be triggered\n * @param {Number} delay - The throttle delay time\n * @return {Function}\n */\nfunction throttle(fn, delay) {\n  var timer = null;\n\n  return function () {\n    var context = this, args = arguments;\n\n    clearTimeout(timer);\n\n    timer = setTimeout(function () {\n      fn.apply(context, args);\n    }, delay);\n  };\n}\n\n/**\n * Preload a image\n * @param {String} src - The image src\n * @param {Function} success - The callback of success\n * @param {Function} error - The callback of error\n */\nfunction preloadImage(src, success, error) {\n  var img = new Image();\n\n  img.onload = function () {\n    success(img);\n  };\n\n  img.onerror = function () {\n    error(img);\n  };\n\n  img.src = src;\n}\n\n/**\n * Request fullscreen\n * @param {type} element\n */\nfunction requestFullscreen(element) {\n  if (element.requestFullscreen) {\n    element.requestFullscreen();\n  } else if (element.mozRequestFullScreen) {\n    element.mozRequestFullScreen();\n  } else if (element.webkitRequestFullscreen) {\n    element.webkitRequestFullscreen();\n  } else if (element.msRequestFullscreen) {\n    element.msRequestFullscreen();\n  }\n}\n\n/**\n * Exit fullscreen\n */\nfunction exitFullscreen() {\n  if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if (document.mozCancelFullScreen) {\n    document.mozCancelFullScreen();\n  } else if (document.webkitExitFullscreen) {\n    document.webkitExitFullscreen();\n  }\n}\n\n/**\n * Get the image name from its url\n * @param {String} url - The image src\n * @return {String}\n */\nfunction getImageNameFromUrl(url) {\n  var reg = /^.*?\\/*([^/?]*)\\.[a-z]+(\\?.+|$)/gi, txt = url.replace(reg, '$1');\n  return txt;\n}\n\n/**\n * Check if the document has a scrollbar\n * @return {Boolean}\n */\nfunction hasScrollbar() {\n  return (\n    document.body.scrollHeight > (window.innerHeight || document.documentElement.clientHeight)\n  );\n}\n\n/**\n * Get the scrollbar width\n * @return {Number}\n */\nfunction getScrollbarWidth() {\n  var scrollDiv = document.createElement('div');\n  scrollDiv.style.cssText = 'width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;';\n  document.body.appendChild(scrollDiv);\n  var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n  document.body.removeChild(scrollDiv);\n\n  return scrollbarWidth;\n}\n\n/**\n * Set grab cursor when move image\n * @param {Object} imageData - The image data\n * @param {Object} stageData - The stage data\n * @param {Object} stage - The stage element\n * @param {Boolean} isRotate - The image rotated flag\n */\nfunction setGrabCursor(imageData, stageData, stage, isRotated) {\n  var imageWidth = !isRotated ? imageData.w : imageData.h;\n  var imageHeight = !isRotated ? imageData.h : imageData.w;\n\n  if (imageHeight > stageData.h || imageWidth > stageData.w) {\n    stage.addClass('is-grab');\n  }\n  if (imageHeight <= stageData.h && imageWidth <= stageData.w) {\n    stage.removeClass('is-grab');\n  }\n}\n\n/**\n * Check if browser support touch event\n * @return {Boolean}\n */\nfunction supportTouch() {\n  return !!(\n    'ontouchstart' in window || (window.DocumentTouch && document instanceof window.DocumentTouch)\n  );\n}\n\n/**\n * Check if the browser is IE8\n * @return {Boolean}\n */\nfunction isIE8() {\n  return (\n    (navigator.appName == 'Microsoft Internet Explorer' && navigator.appVersion.indexOf('MSIE 8.0') > 0) ||\n    (navigator.appName == 'Microsoft Internet Explorer' && navigator.appVersion.indexOf('MSIE 7.0') > 0)\n  );\n}\n\n/**\n * Private static constants\n */\n\nvar $W = $(window),\n  $D = $(document),\n  CLICK_EVENT = 'click',\n  RESIZE_EVENT = 'resize',\n  KEYDOWN_EVENT = 'keydown',\n  WHEEL_EVENT = 'wheel mousewheel DOMMouseScroll',\n  TOUCH_START_EVENT = supportTouch() ? 'touchstart' : 'mousedown',\n  TOUCH_MOVE_EVENT = supportTouch() ? 'touchmove' : 'mousemove',\n  TOUCH_END_EVENT = supportTouch() ? 'touchend' : 'mouseup',\n  NS = 'magnify',\n  EVENT_NS = '.' + NS,\n  // Plugin default options\n  DEFAULTS = {\n    // Enable modal to drag\n    draggable: true,\n    // Enable modal to resize\n    resizable: true,\n    // Enable image to move\n    movable: true,\n    // Enable keyboard navigation\n    keyboard: true,\n    // Shows the title\n    title: true,\n    // Min width of modal\n    modalWidth: 320,\n    // Min height of modal\n    modalHeight: 320,\n    // Enable the page content fixed\n    fixedContent: true,\n    // Disable the modal size fixed\n    fixedModalSize: false,\n    // Disable the image viewer maximized on init\n    initMaximized: false,\n    // Threshold of modal to browser window\n    gapThreshold: 0.02,\n    // Threshold of image ratio\n    ratioThreshold: 0.1,\n    // Min ratio of image when zoom out\n    minRatio: 0.05,\n    // Max ratio of image when zoom in\n    maxRatio: 16,\n    // Toolbar options in header\n    headerToolbar: ['maximize', 'close'],\n    // Toolbar options in footer\n    footerToolbar: [\n      'zoomIn',\n      'zoomOut',\n      'prev',\n      'fullscreen',\n      'next',\n      'actualSize',\n      'rotateRight'\n    ],\n    // Customize button icon\n    icons: {\n      minimize:\n        '<svg viewBox=\"0 0 1024 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M1024 749.714v109.714c0 50.286-41.143 91.429-91.429 91.429\\\n          h-841.143c-50.286 0-91.429-41.143-91.429-91.429v-109.714c0-50.286 41.143-91.429 91.429\\\n          -91.429h841.143c50.286 0 91.429 41.143 91.429 91.429z\"></path>\\\n        </svg>',\n      maximize:\n        '<svg viewBox=\"0 0 1024 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M146.286 804.571h731.429v-438.857h-731.429v438.857z\\\n          M1024 164.571v694.857c0 50.286-41.143 91.429-91.429 91.429h-841.143c-50.286 0\\\n          -91.429-41.143-91.429-91.429v-694.857c0-50.286 41.143-91.429 91.429-91.429\\\n          h841.143c50.286 0 91.429 41.143 91.429 91.429z\"></path>\\\n        </svg>',\n      close:\n        '<svg viewBox=\"0 0 804.5714285714286 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M741.714 755.429c0 14.286-5.714 28.571-16 38.857\\\n          l-77.714 77.714c-10.286 10.286-24.571 16-38.857 16s-28.571-5.714-38.857-16l-168-168\\\n          -168 168c-10.286 10.286-24.571 16-38.857 16s-28.571-5.714-38.857-16l-77.714-77.714\\\n          c-10.286-10.286-16-24.571-16-38.857s5.714-28.571 16-38.857l168-168-168-168c-10.286-10.286\\\n          -16-24.571-16-38.857s5.714-28.571 16-38.857l77.714-77.714c10.286-10.286 24.571-16 38.857\\\n          -16s28.571 5.714 38.857 16l168 168 168-168c10.286-10.286 24.571-16 38.857-16\\\n          s28.571 5.714 38.857 16l77.714 77.714c10.286 10.286 16 24.571 16 38.857s-5.714 28.571\\\n          -16 38.857l-168 168 168 168c10.286 10.286 16 24.571 16 38.857z\"></path>\\\n        </svg>',\n      zoomIn:\n        '<svg viewBox=\"0 0 950.8571428571428 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M585.143 457.143v36.571c0 9.714-8.571 18.286-18.286 18.286\\\n          h-128v128c0 9.714-8.571 18.286-18.286 18.286h-36.571c-9.714 0-18.286-8.571-18.286-18.286\\\n          v-128h-128c-9.714 0-18.286-8.571-18.286-18.286v-36.571c0-9.714 8.571-18.286 18.286-18.286\\\n          h128v-128c0-9.714 8.571-18.286 18.286-18.286h36.571c9.714 0 18.286 8.571 18.286 18.286\\\n          v128h128c9.714 0 18.286 8.571 18.286 18.286zM658.286 475.429c0-141.143-114.857-256-256\\\n          -256s-256 114.857-256 256 114.857 256 256 256 256-114.857 256-256zM950.857 950.857\\\n          c0 40.571-32.571 73.143-73.143 73.143-19.429 0-38.286-8-51.429-21.714l-196-195.429\\\n          c-66.857 46.286-146.857 70.857-228 70.857-222.286 0-402.286-180-402.286-402.286s180\\\n          -402.286 402.286-402.286 402.286 180 402.286 402.286c0 81.143-24.571 161.143-70.857 228\\\n          l196 196c13.143 13.143 21.143 32 21.143 51.429z\"></path>\\\n        </svg>',\n      zoomOut:\n        '<svg viewBox=\"0 0 950.8571428571428 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M585.143 457.143v36.571c0 9.714-8.571 18.286-18.286 18.286\\\n          h-329.143c-9.714 0-18.286-8.571-18.286-18.286v-36.571c0-9.714 8.571-18.286 18.286-18.286\\\n          h329.143c9.714 0 18.286 8.571 18.286 18.286zM658.286 475.429c0-141.143-114.857-256-256\\\n          -256s-256 114.857-256 256 114.857 256 256 256 256-114.857 256-256zM950.857 950.857\\\n          c0 40.571-32.571 73.143-73.143 73.143-19.429 0-38.286-8-51.429-21.714l-196-195.429\\\n          c-66.857 46.286-146.857 70.857-228 70.857-222.286 0-402.286-180-402.286-402.286s180\\\n          -402.286 402.286-402.286 402.286 180 402.286 402.286c0 81.143-24.571 161.143-70.857 228\\\n          l196 196c13.143 13.143 21.143 32 21.143 51.429z\"></path>\\\n        </svg>',\n      prev:\n        '<svg viewBox=\"0 0 914.2857142857142 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M877.714 512v73.143c0 38.857-25.714 73.143-66.857 73.143\\\n          h-402.286l167.429 168c13.714 13.143 21.714 32 21.714 51.429s-8 38.286-21.714 51.429\\\n          l-42.857 43.429c-13.143 13.143-32 21.143-51.429 21.143s-38.286-8-52-21.143l-372-372.571\\\n          c-13.143-13.143-21.143-32-21.143-51.429s8-38.286 21.143-52l372-371.429c13.714\\\n          -13.714 32.571-21.714 52-21.714s37.714 8 51.429 21.714l42.857 42.286\\\n          c13.714 13.714 21.714 32.571 21.714 52s-8 38.286-21.714 52l-167.429 167.429h402.286\\\n          c41.143 0 66.857 34.286 66.857 73.143z\"></path>\\\n        </svg>',\n      next:\n        '<svg viewBox=\"0 0 841.1428571428571 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M841.143 548.571c0 19.429-7.429 38.286-21.143 52l-372 372\\\n          c-13.714 13.143-32.571 21.143-52 21.143s-37.714-8-51.429-21.143l-42.857-42.857c-13.714\\\n          -13.714-21.714-32.571-21.714-52s8-38.286 21.714-52l167.429-167.429h-402.286c-41.143 0\\\n          -66.857-34.286-66.857-73.143v-73.143c0-38.857 25.714-73.143 66.857-73.143h402.286\\\n          l-167.429-168c-13.714-13.143-21.714-32-21.714-51.429s8-38.286 21.714-51.429l42.857\\\n          -42.857c13.714-13.714 32-21.714 51.429-21.714s38.286 8 52 21.714l372 372\\\n          c13.714 13.143 21.143 32 21.143 51.429z\"></path>\\\n        </svg>',\n      fullscreen:\n        '<svg viewBox=\"0 0 1097.142857142857 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M365.714 329.143c0 60.571-49.143 109.714-109.714 109.714\\\n          s-109.714-49.143-109.714-109.714 49.143-109.714 109.714\\\n          -109.714 109.714 49.143 109.714 109.714zM950.857 548.571v256h-804.571v-109.714l182.857\\\n          -182.857 91.429 91.429 292.571-292.571zM1005.714 146.286h-914.286c-9.714 0-18.286 8.571\\\n          -18.286 18.286v694.857c0 9.714 8.571 18.286 18.286 18.286h914.286c9.714 0 18.286\\\n          -8.571 18.286-18.286v-694.857c0-9.714-8.571-18.286-18.286-18.286zM1097.143 164.571\\\n          v694.857c0 50.286-41.143 91.429-91.429 91.429h-914.286c-50.286 0-91.429-41.143-91.429\\\n          -91.429v-694.857c0-50.286 41.143-91.429 91.429-91.429h914.286\\\n          c50.286 0 91.429 41.143 91.429 91.429z\"></path>\\\n        </svg>',\n      actualSize:\n        '<svg viewBox=\"0 0 877.7142857142857 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M733.143 309.143l-202.857 202.857 202.857 202.857 82.286\\\n          -82.286c10.286-10.857 26.286-13.714 40-8 13.143 5.714 22.286 18.857 22.286 33.714v256\\\n          c0 20-16.571 36.571-36.571 36.571h-256c-14.857 0-28-9.143-33.714-22.857-5.714-13.143\\\n          -2.857-29.143 8-39.429l82.286-82.286-202.857-202.857-202.857 202.857 82.286 82.286\\\n          c10.857 10.286 13.714 26.286 8 39.429-5.714 13.714-18.857 22.857-33.714 22.857h-256\\\n          c-20 0-36.571-16.571-36.571-36.571v-256c0-14.857 9.143-28 22.857-33.714 13.143\\\n          -5.714 29.143-2.857 39.429 8l82.286 82.286 202.857-202.857-202.857-202.857-82.286 82.286\\\n          c-6.857 6.857-16 10.857-25.714 10.857-4.571 0-9.714-1.143-13.714-2.857-13.714-5.714\\\n          -22.857-18.857-22.857-33.714v-256c0-20 16.571-36.571 36.571-36.571h256\\\n          c14.857 0 28 9.143 33.714 22.857 5.714 13.143 2.857 29.143-8 39.429\\\n          l-82.286 82.286 202.857 202.857 202.857-202.857-82.286-82.286c-10.857-10.286-13.714\\\n          -26.286-8-39.429 5.714-13.714 18.857-22.857 33.714-22.857h256\\\n          c20 0 36.571 16.571 36.571 36.571v256c0 14.857-9.143 28-22.286 33.714-4.571 1.714\\\n          -9.714 2.857-14.286 2.857-9.714 0-18.857-4-25.714-10.857z\"></path>\\\n        </svg>',\n      rotateLeft:\n        '<svg viewBox=\"0 0 877.7142857142857 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M877.714 512c0 241.714-197.143 438.857-438.857 438.857\\\n          -130.857 0-254.286-57.714-337.714-158.286-5.714-7.429-5.143-18.286 1.143-24.571l78.286\\\n          -78.857c4-3.429 9.143-5.143 14.286\\\n          -5.143 5.143 0.571 10.286 2.857 13.143 6.857 56 72.571 140 113.714 230.857 113.714 161.143 0 292.571\\\n          -131.429 292.571-292.571s-131.429-292.571-292.571-292.571c-74.857 0-145.714 28.571\\\n          -198.857 78.286l78.286 78.857c10.857 10.286 13.714 26.286 8 39.429-5.714 13.714\\\n          -18.857 22.857-33.714 22.857h-256c-20 0-36.571-16.571-36.571-36.571v-256\\\n          c0-14.857 9.143-28 22.857-33.714 13.143-5.714 29.143-2.857 39.429 8l74.286 73.714\\\n          c80.571-76 189.714-121.143 302.286-121.143 241.714 0 438.857 197.143 438.857 438.857z\"></path>\\\n        </svg>',\n      rotateRight:\n        '<svg viewBox=\"0 0 877.7142857142857 1024\" class=\"svg-inline-icon\">\\\n          <path fill=\"currentColor\" d=\"M877.714 146.286v256c0 20-16.571 36.571-36.571 36.571h-256\\\n          c-14.857 0-28-9.143-33.714-22.857-5.714-13.143-2.857-29.143 8-39.429l78.857-78.857\\\n          c-53.714-49.714-124.571-78.286-199.429-78.286-161.143 0-292.571 131.429-292.571 292.571\\\n          s131.429 292.571 292.571 292.571c90.857 0 174.857-41.143 230.857-113.714 2.857-4 8\\\n          -6.286 13.143-6.857 5.143 0 10.286 1.714 14.286 5.143l78.286 78.857\\\n          c6.857 6.286 6.857 17.143 1.143 24.571-83.429 100.571-206.857 158.286-337.714 158.286\\\n          -241.714 0-438.857-197.143-438.857-438.857s197.143-438.857 438.857-438.857\\\n          c112.571 0 221.714 45.143 302.286 121.143l74.286-73.714c10.286-10.857 26.286-13.714 40\\\n          -8 13.143 5.714 22.286 18.857 22.286 33.714z\"></path>\\\n        </svg>'\n    },\n    // Customize language of button title\n    i18n: {\n      minimize: 'minimize',\n      maximize: 'maximize',\n      close: 'close',\n      zoomIn: 'zoom-in(+)',\n      zoomOut: 'zoom-out(-)',\n      prev: 'prev(←)',\n      next: 'next(→)',\n      fullscreen: 'fullscreen',\n      actualSize: 'actual-size(Ctrl+Alt+0)',\n      rotateLeft: 'rotate-left(Ctrl+,)',\n      rotateRight: 'rotate-right(Ctrl+.)'\n    },\n    // Enable multiple instances\n    multiInstances: true,\n    // Init trigger event\n    initEvent: 'click',\n    // Enable animation\n    initAnimation: true,\n    // Disable modal position fixed when change images\n    fixedModalPos: false,\n    // Modal z-index\n    zIndex: 1090,\n    // Selector of drag handler\n    dragHandle: false,\n    // Callback events\n    callbacks: {\n      beforeOpen: $.noop,\n      opened: $.noop,\n      beforeClose: $.noop,\n      closed: $.noop,\n      beforeChange: $.noop,\n      changed: $.noop\n    },\n    // Load the image progressively\n    progressiveLoading: true,\n    // Custom Buttons\n    customButtons: {}\n  },\n  PUBLIC_VARS = {\n    // Image moving flag\n    isMoving: false,\n    // Modal resizing flag\n    isResizing: false,\n    // Modal z-index setting\n    zIndex: DEFAULTS.zIndex\n  };\n\n// jQuery element of calling plugin\nvar jqEl = null;\n\n/**\n * Magnify Class\n */\nvar Magnify = function (el, options) {\n  var self = this;\n\n  this.options = $.extend(true, {}, DEFAULTS, options);\n\n  if (options && $.isArray(options.footerToolbar)) {\n    this.options.footerToolbar = options.footerToolbar;\n  }\n\n  if (options && $.isArray(options.headerToolbar)) {\n    this.options.headerToolbar = options.headerToolbar;\n  }\n\n  // Store element of clicked\n  this.$el = $(el);\n\n  // As we have multiple instances,\n  // so every instance has following variables.\n\n  // modal open flag\n  this.isOpened = false;\n  // modal maximize flag\n  this.isMaximized = false;\n  // image rotate 90*(2n+1) flag\n  this.isRotated = false;\n  // image rotate angle\n  this.rotateAngle = 0;\n\n  // if modal do resize\n  this.isDoResize = false;\n\n  // Store image data in every instance\n  this.imageData = {};\n  // Store modal data in every instance\n  this.modalData = {\n    width: null,\n    height: null,\n    left: null,\n    top: null\n  };\n\n  this.init(el, self.options);\n};\n\n/**\n * Mangify Prototype\n */\nMagnify.prototype = {\n  init: function (el, opts) {\n    // Get image src\n    var imgSrc = getImageSrc(el);\n\n    // Get image group\n    this.groupName = null;\n\n    var currentGroupName = $(el).attr('data-group'),\n      groupList = $D.find('[data-group=\"' + currentGroupName + '\"]');\n\n    if (currentGroupName !== undefined) {\n      this.groupName = currentGroupName;\n      this.getImageGroup(groupList, imgSrc);\n    } else {\n      this.getImageGroup(jqEl.not('[data-group]'), imgSrc);\n    }\n\n    this.open();\n\n    this.loadImage(imgSrc);\n\n    // Draggable & Movable & Resizable\n    if (opts.draggable) {\n      this.draggable(this.$magnify, this.dragHandle, '.magnify-button');\n    }\n    if (opts.movable) {\n      this.movable(this.$stage, isIE8() ? '.magnify-image' : this.$image);\n    }\n    if (opts.resizable) {\n      this.resizable(\n        this.$magnify,\n        this.$stage,\n        isIE8() ? '.magnify-image' : this.$image,\n        opts.modalWidth,\n        opts.modalHeight\n      );\n    }\n  },\n  _createBtns: function (toolbar) {\n    var self = this;\n\n    var btns = [\n      'minimize', 'maximize', 'close',\n      'zoomIn', 'zoomOut', 'prev', 'next', 'fullscreen', 'actualSize', 'rotateLeft', 'rotateRight'\n    ];\n    var btnsHTML = '';\n\n    $.each(toolbar, function (index, item) {\n      if ($.inArray(item, btns) >= 0) {\n        btnsHTML +=\n          '<button class=\"magnify-button magnify-button-' + item + '\" title=\"' + self.options.i18n[item] + '\">' +\n          self.options.icons[item] +\n          '</button>';\n      } else if (self.options.customButtons[item]) {\n        btnsHTML +=\n          '<button class=\"magnify-button magnify-button-' + item + '\" title=\"' + (self.options.customButtons[item].title || '') + '\">' +\n          self.options.customButtons[item].text +\n          '</button>';\n      }\n    });\n\n    return btnsHTML;\n  },\n  _createTitle: function () {\n    return this.options.title ? '<div class=\"magnify-title\"></div>' : '';\n  },\n  _createTemplate: function () {\n    // Magnify base HTML\n    var magnifyHTML =\n      '<div class=\"magnify-modal\" tabindex=\"0\">\\\n        <div class=\"magnify-header\">\\\n          <div class=\"magnify-toolbar\">' +\n      this._createBtns(this.options.headerToolbar) + '\\\n          </div>' +\n      this._createTitle() + '\\\n        </div>\\\n        <div class=\"magnify-stage\">\\\n          <img class=\"magnify-image\" src=\"\" alt=\"\" />\\\n        </div>\\\n        <div class=\"magnify-footer\">\\\n          <div class=\"magnify-toolbar\">' +\n      this._createBtns(this.options.footerToolbar) + '\\\n          </div>\\\n        </div>\\\n      </div>';\n\n    return magnifyHTML;\n  },\n  build: function () {\n    // Create magnify HTML string\n    var magnifyHTML = this._createTemplate();\n\n    // Make magnify HTML string to jQuery element\n    var $magnify = $(magnifyHTML);\n\n    // Get all magnify element\n    this.$magnify = $magnify;\n    this.$stage = $magnify.find('.magnify-stage');\n    this.$title = $magnify.find('.magnify-title');\n    this.$image = $magnify.find('.magnify-image');\n    this.$close = $magnify.find('.magnify-button-close');\n    this.$maximize = $magnify.find('.magnify-button-maximize');\n    this.$minimize = $magnify.find('.magnify-button-minimize');\n    this.$zoomIn = $magnify.find('.magnify-button-zoomIn');\n    this.$zoomOut = $magnify.find('.magnify-button-zoomOut');\n    this.$actualSize = $magnify.find('.magnify-button-actualSize');\n    this.$fullscreen = $magnify.find('.magnify-button-fullscreen');\n    this.$rotateLeft = $magnify.find('.magnify-button-rotateLeft');\n    this.$rotateRight = $magnify.find('.magnify-button-rotateRight');\n    this.$prev = $magnify.find('.magnify-button-prev');\n    this.$next = $magnify.find('.magnify-button-next');\n\n    // Add class before image loaded\n    this.$stage.addClass('stage-ready');\n    this.$image.addClass('image-ready');\n\n    // Reset modal z-index with multiple instances\n    this.$magnify.css('z-index', PUBLIC_VARS['zIndex']);\n\n    // Set handle element of draggable\n    if (\n      !this.options.dragHandle ||\n      this.options.dragHandle === '.magnify-modal'\n    ) {\n      this.dragHandle = this.$magnify;\n    } else {\n      this.dragHandle = this.$magnify.find(this.options.dragHandle);\n    }\n\n    // Add Magnify to DOM\n    $('body').append(this.$magnify);\n\n    this._addEvents();\n    this._addCustomButtonEvents();\n  },\n  open: function () {\n    this._triggerHook('beforeOpen', this);\n\n    if (!this.options.multiInstances) {\n      $('.magnify-modal').eq(0).remove();\n    }\n\n    // Fixed modal position bug\n    if (!$('.magnify-modal').length && this.options.fixedContent) {\n      $('html').css({ overflow: 'hidden' });\n\n      if (hasScrollbar()) {\n        var scrollbarWidth = getScrollbarWidth();\n        if (scrollbarWidth) {\n          $('html').css({ 'padding-right': scrollbarWidth });\n        }\n      }\n    }\n\n    this.build();\n\n    this.setModalPos(this.$magnify);\n\n    this.$magnify.focus();\n\n    this._triggerHook('opened', this);\n  },\n  close: function (el) {\n    this._triggerHook('beforeClose', this);\n\n    // Remove instance\n    this.$magnify.remove();\n\n    this.isOpened = false;\n    this.isMaximized = false;\n    this.isRotated = false;\n    this.rotateAngle = 0;\n\n    if (!$('.magnify-modal').length) {\n      // Fixed modal position bug\n      if (this.options.fixedContent) {\n        $('html').css({ overflow: '', 'padding-right': '' });\n      }\n\n      // Reset zIndex after close\n      if (this.options.multiInstances) {\n        PUBLIC_VARS['zIndex'] = this.options.zIndex;\n      }\n\n      // off resize events\n      $W.off(RESIZE_EVENT + EVENT_NS);\n    }\n\n    this._triggerHook('closed', this);\n  },\n  setModalPos: function (modal) {\n    var winWidth = $W.width(),\n      winHeight = $W.height(),\n      scrollLeft = $D.scrollLeft(),\n      scrollTop = $D.scrollTop();\n\n    var modalWidth = this.options.modalWidth,\n      modalHeight = this.options.modalHeight;\n\n    // Set modal maximized when init\n    if (this.options.initMaximized) {\n      modal.addClass('magnify-maximize');\n\n      modal.css({\n        width: '100%',\n        height: '100%',\n        left: 0,\n        top: 0\n      });\n\n      this.isOpened = true;\n      this.isMaximized = true;\n    } else {\n      // Make the modal in windows center\n      modal.css({\n        width: modalWidth,\n        height: modalHeight,\n        left: (winWidth - modalWidth) / 2 + scrollLeft + 'px',\n        top: (winHeight - modalHeight) / 2 + scrollTop + 'px'\n      });\n    }\n  },\n  setModalSize: function (img) {\n    var self = this,\n      winWidth = $W.width(),\n      winHeight = $W.height(),\n      scrollLeft = $D.scrollLeft(),\n      scrollTop = $D.scrollTop();\n\n    // Stage css value\n    var stageCSS = {\n      left: this.$stage.css('left'),\n      right: this.$stage.css('right'),\n      top: this.$stage.css('top'),\n      bottom: this.$stage.css('bottom'),\n      borderLeft: this.$stage.css('border-left-width'),\n      borderRight: this.$stage.css('border-right-width'),\n      borderTop: this.$stage.css('border-top-width'),\n      borderBottom: this.$stage.css('border-bottom-width')\n    };\n\n    // Modal size should calc with stage css value\n    var modalWidth = img.width +\n      parseFloat(stageCSS.left) +\n      parseFloat(stageCSS.right) +\n      parseFloat(stageCSS.borderLeft) +\n      parseFloat(stageCSS.borderRight);\n    var modalHeight = img.height +\n      parseFloat(stageCSS.top) +\n      parseFloat(stageCSS.bottom) +\n      parseFloat(stageCSS.borderTop) +\n      parseFloat(stageCSS.borderBottom);\n\n    var gapThreshold = (this.options.gapThreshold > 0 ? this.options.gapThreshold : 0) + 1;\n    // Modal scale to window\n    var scale = Math.min(\n      winWidth / (modalWidth * gapThreshold),\n      winHeight / (modalHeight * gapThreshold),\n      1\n    );\n\n    var minWidth = Math.max(modalWidth * scale, this.options.modalWidth);\n    var minHeight = Math.max(modalHeight * scale, this.options.modalHeight);\n\n    minWidth = this.options.fixedModalSize ? this.options.modalWidth : Math.round(minWidth);\n    minHeight = this.options.fixedModalSize ? this.options.modalHeight : Math.round(minHeight);\n\n    var modalCSSObj = {\n      width: minWidth + 'px',\n      height: minHeight + 'px',\n      left: (winWidth - minWidth) / 2 + scrollLeft + 'px',\n      top: (winHeight - minHeight) / 2 + scrollTop + 'px'\n    };\n\n    // Add modal init animation\n    if (this.options.initAnimation) {\n      this.$magnify.animate(modalCSSObj, function () {\n        self.setImageSize(img);\n      });\n    } else {\n      this.$magnify.css(modalCSSObj);\n      this.setImageSize(img);\n    }\n\n    this.isOpened = true;\n  },\n  getImageScaleToStage: function (stageWidth, stageHeight) {\n    var scale = 1;\n\n    if (!this.isRotated) {\n      scale = Math.min(\n        stageWidth / this.img.width,\n        stageHeight / this.img.height,\n        1\n      );\n    } else {\n      scale = Math.min(\n        stageWidth / this.img.height,\n        stageHeight / this.img.width,\n        1\n      );\n    }\n\n    return scale;\n  },\n  setImageSize: function (img) {\n    var $image = isIE8() ? this.$stage.find('.magnify-image') : this.$image;\n\n    var stageData = {\n      w: this.$stage.width(),\n      h: this.$stage.height()\n    };\n\n    var scale = this.getImageScaleToStage(stageData.w, stageData.h);\n\n    $image.css({\n      width: Math.ceil(img.width * scale) + 'px',\n      height: Math.ceil(img.height * scale) + 'px',\n      left: (stageData.w - Math.ceil(img.width * scale)) / 2 + 'px',\n      top: (stageData.h - Math.ceil(img.height * scale)) / 2 + 'px'\n    });\n\n    if (isIE8()) {\n      $image.find('group').css({\n        width: Math.floor(img.width * scale) + 'px',\n        height: Math.floor(img.height * scale) + 'px'\n      });\n    }\n\n    // Store image initial data\n    $.extend(this.imageData, {\n      initWidth: img.width * scale,\n      initHeight: img.height * scale,\n      initLeft: (stageData.w - img.width * scale) / 2,\n      initTop: (stageData.h - img.height * scale) / 2,\n      width: img.width * scale,\n      height: img.height * scale,\n      left: (stageData.w - img.width * scale) / 2,\n      top: (stageData.h - img.height * scale) / 2\n    });\n\n    // Set grab cursor\n    setGrabCursor(\n      { w: $image.width(), h: $image.height() },\n      { w: this.$stage.width(), h: this.$stage.height() },\n      this.$stage,\n      this.isRotated\n    );\n\n    // Just execute before image loaded\n    if (!this.imageLoaded) {\n      // loader end\n      this.$magnify.find('.magnify-loader').remove();\n\n      // Remove class must when image setting end\n      this.$stage.removeClass('stage-ready');\n      this.$image.removeClass('image-ready');\n\n      // Add image init animation\n      if (this.options.initAnimation && !this.options.progressiveLoading) {\n        $image.fadeIn();\n      }\n\n      this.imageLoaded = true;\n    }\n  },\n  loadImage: function (imgSrc, fn, err) {\n    var self = this;\n\n    // Reset image\n    this.$image.removeAttr('style').attr('src', '');\n    this.isRotated = false;\n    this.rotateAngle = 0;\n\n    this.imageLoaded = false;\n\n    // Loader start\n    this.$magnify.append('<div class=\"magnify-loader\"></div>');\n\n    // Add class before image loaded\n    this.$stage.addClass('stage-ready');\n    this.$image.addClass('image-ready');\n\n    if (this.options.initAnimation && !this.options.progressiveLoading) {\n      this.$image.hide();\n    }\n\n    if (isIE8()) {\n      this.$stage.html(\n        '<img class=\"magnify-image\" id=\"magnify-image\" src=\"' + imgSrc + '\" alt=\"\" />'\n      );\n    } else {\n      this.$image.attr('src', imgSrc);\n    }\n\n    preloadImage(\n      imgSrc,\n      function (img) {\n        // Store HTMLImageElement\n        self.img = img;\n\n        // Store original data\n        self.imageData = {\n          originalWidth: img.width,\n          originalHeight: img.height\n        };\n\n        if (self.isMaximized || (self.isOpened && self.options.fixedModalPos)) {\n          self.setImageSize(img);\n        } else {\n          self.setModalSize(img);\n        }\n\n        // Callback of image loaded successfully\n        if (fn) {\n          fn.call();\n        }\n      },\n      function () {\n        // Loader end\n        self.$magnify.find('.magnify-loader').remove();\n\n        // Callback of image loading failed\n        if (err) {\n          err.call();\n        }\n      }\n    );\n\n    if (this.options.title) {\n      this.setImageTitle(imgSrc);\n    }\n  },\n  getImageGroup: function (list, imgSrc) {\n    var self = this;\n\n    self.groupData = [];\n\n    $(list).each(function (index, item) {\n      var _imgSrc = getImageSrc(this);\n\n      self.groupData.push({\n        src: _imgSrc,\n        caption: $(this).attr('data-caption')\n      });\n      // Get image index\n      if (imgSrc === _imgSrc) {\n        self.groupIndex = index;\n      }\n    });\n  },\n  setImageTitle: function (url) {\n    var title = this.groupData[this.groupIndex].caption || getImageNameFromUrl(url);\n\n    this.$title.html(title);\n  },\n  jump: function (step) {\n    this._triggerHook('beforeChange', [this, this.groupIndex]);\n\n    this.groupIndex = this.groupIndex + step;\n\n    this.jumpTo(this.groupIndex);\n  },\n  jumpTo: function (index) {\n    var self = this;\n\n    index = index % this.groupData.length;\n\n    if (index >= 0) {\n      index = index % this.groupData.length;\n    } else if (index < 0) {\n      index = (this.groupData.length + index) % this.groupData.length;\n    }\n\n    this.groupIndex = index;\n\n    this.loadImage(\n      this.groupData[index].src,\n      function () {\n        self._triggerHook('changed', [self, index]);\n      },\n      function () {\n        self._triggerHook('changed', [self, index]);\n      }\n    );\n  },\n  wheel: function (e) {\n    e.preventDefault();\n\n    var delta = 1;\n\n    if (e.originalEvent.deltaY) {\n      delta = e.originalEvent.deltaY > 0 ? 1 : -1;\n    } else if (e.originalEvent.wheelDelta) {\n      delta = -e.originalEvent.wheelDelta / 120;\n    } else if (e.originalEvent.detail) {\n      delta = e.originalEvent.detail > 0 ? 1 : -1;\n    }\n\n    // Ratio threshold\n    var ratio = -delta * this.options.ratioThreshold;\n\n    // Mouse point position relative to stage\n    var pointer = {\n      x: e.originalEvent.clientX - this.$stage.offset().left + $D.scrollLeft(),\n      y: e.originalEvent.clientY - this.$stage.offset().top + $D.scrollTop()\n    };\n\n    this.zoom(ratio, pointer, e);\n  },\n  zoom: function (ratio, origin, e) {\n    this.$image = isIE8() ? this.$stage.find('.magnify-image') : this.$image;\n\n    // Zoom out ratio & Zoom in ratio\n    ratio = ratio < 0 ? 1 / (1 - ratio) : 1 + ratio;\n\n    // Image ratio\n    ratio = (this.$image.width() / this.imageData.originalWidth) * ratio;\n\n    // Fixed digital error\n    // if (ratio > 0.95 && ratio < 1.05) {\n    //   ratio = 1;\n    // }\n\n    if (ratio > this.options.maxRatio || ratio < this.options.minRatio) {\n      return;\n    }\n\n    this.zoomTo(ratio, origin, e);\n  },\n  zoomTo: function (ratio, origin, e) {\n    var $image = isIE8() ? this.$stage.find('.magnify-image') : this.$image;\n    var $stage = this.$stage;\n    var imgData = {\n      w: this.imageData.width,\n      h: this.imageData.height,\n      x: this.imageData.left,\n      y: this.imageData.top\n    };\n\n    // Image stage position\n    // We will use it to calc the relative position of image\n    var stageData = {\n      w: $stage.width(),\n      h: $stage.height(),\n      x: $stage.offset().left,\n      y: $stage.offset().top\n    };\n\n    var newWidth = this.imageData.originalWidth * ratio;\n    var newHeight = this.imageData.originalHeight * ratio;\n    // Think about it for a while\n    var newLeft = origin.x - ((origin.x - imgData.x) / imgData.w) * newWidth;\n    var newTop = origin.y - ((origin.y - imgData.y) / imgData.h) * newHeight;\n\n    // δ is the difference between image new width and new height\n    var δ = !this.isRotated ? 0 : (newWidth - newHeight) / 2;\n    var imgNewWidth = !this.isRotated ? newWidth : newHeight;\n    var imgNewHeight = !this.isRotated ? newHeight : newWidth;\n\n    var offsetX = stageData.w - newWidth, offsetY = stageData.h - newHeight;\n\n    // Zoom out & Zoom in condition\n    // It's important and it takes me a lot of time to get it\n    // The conditions with image rotate 90 degree drive me crazy alomst!\n    if (imgNewHeight <= stageData.h) {\n      newTop = (stageData.h - newHeight) / 2;\n    } else {\n      newTop = newTop > δ ? δ : newTop > offsetY - δ ? newTop : offsetY - δ;\n    }\n\n    if (imgNewWidth <= stageData.w) {\n      newLeft = (stageData.w - newWidth) / 2;\n    } else {\n      newLeft = newLeft > -δ ? -δ : newLeft > offsetX + δ ? newLeft : offsetX + δ;\n    }\n\n    // If the image scale get to the critical point\n    if (Math.abs(this.imageData.initWidth - newWidth) < this.imageData.initWidth * 0.05) {\n      this.setImageSize(this.img);\n    } else {\n      $image.css({\n        width: Math.round(newWidth) + 'px',\n        height: Math.round(newHeight) + 'px',\n        left: Math.round(newLeft) + 'px',\n        top: Math.round(newTop) + 'px'\n      });\n\n      if (isIE8()) {\n        $image.find('group').css({\n          width: Math.ceil(newWidth) + 'px',\n          height: Math.ceil(newHeight) + 'px'\n        });\n      }\n\n      // Set grab cursor\n      setGrabCursor(\n        { w: Math.round(imgNewWidth), h: Math.round(imgNewHeight) },\n        { w: stageData.w, h: stageData.h },\n        this.$stage\n      );\n    }\n\n    // Update image initial data\n    $.extend(this.imageData, {\n      width: newWidth,\n      height: newHeight,\n      left: newLeft,\n      top: newTop\n    });\n  },\n  rotate: function (angle) {\n    this.rotateAngle = this.rotateAngle + angle;\n\n    if ((this.rotateAngle / 90) % 2 === 0) {\n      this.isRotated = false;\n    } else {\n      this.isRotated = true;\n    }\n\n    this.rotateTo(this.rotateAngle);\n  },\n  rotateTo: function (angle) {\n    var $image = isIE8() ? this.$stage.find('.magnify-image') : this.$image;\n\n    // Depend on jQueryRotate.js\n    $image.rotate({\n      angle: angle\n    });\n\n    this.setImageSize({\n      width: this.imageData.originalWidth,\n      height: this.imageData.originalHeight\n    });\n\n    // Remove grab cursor when rotate\n    this.$stage.removeClass('is-grab');\n  },\n  resize: function () {\n    var self = this;\n\n    var resizeHandler = throttle(function () {\n      if (self.isOpened) {\n        if (self.isMaximized) {\n          self.setImageSize({\n            width: self.imageData.originalWidth,\n            height: self.imageData.originalHeight\n          });\n        } else {\n          self.setModalSize({\n            width: self.imageData.originalWidth,\n            height: self.imageData.originalHeight\n          });\n        }\n      }\n    }, 500);\n\n    return resizeHandler;\n  },\n  maximize: function () {\n    this.$magnify.focus();\n\n    if (!this.isMaximized) {\n      // Store modal data before maximize\n      this.modalData = {\n        width: this.$magnify.width(),\n        height: this.$magnify.height(),\n        left: this.$magnify.offset().left,\n        top: this.$magnify.offset().top\n      };\n\n      this.$magnify.addClass('magnify-maximize');\n\n      this.$magnify.css({\n        width: '100%',\n        height: '100%',\n        left: 0,\n        top: 0\n      });\n\n      this.isMaximized = true;\n    } else {\n      this.$magnify.removeClass('magnify-maximize');\n\n      var initModalLeft = ($W.width() - this.options.modalWidth) / 2 + $D.scrollLeft();\n      var initModalTop = ($W.height() - this.options.modalHeight) / 2 + $D.scrollTop();\n\n      this.$magnify.css({\n        width: this.modalData.width ? this.modalData.width : this.options.modalWidth,\n        height: this.modalData.height ? this.modalData.height : this.options.modalHeight,\n        left: this.modalData.left ? this.modalData.left : initModalLeft,\n        top: this.modalData.top ? this.modalData.top : initModalTop\n      });\n\n      this.isMaximized = false;\n    }\n\n    this.setImageSize({\n      width: this.imageData.originalWidth,\n      height: this.imageData.originalHeight\n    });\n  },\n  fullscreen: function () {\n    this.$magnify.focus();\n    requestFullscreen(this.$magnify[0]);\n  },\n  _keydown: function (e) {\n    var self = this;\n\n    if (!this.options.keyboard) {\n      return false;\n    }\n\n    var keyCode = e.keyCode || e.which || e.charCode,\n      ctrlKey = e.ctrlKey || e.metaKey,\n      altKey = e.altKey || e.metaKey;\n\n    switch (keyCode) {\n      // ←\n      case 37:\n        self.jump(-1);\n        break;\n      // →\n      case 39:\n        self.jump(1);\n        break;\n      // +\n      case 187:\n        self.zoom(\n          self.options.ratioThreshold * 3,\n          { x: self.$stage.width() / 2, y: self.$stage.height() / 2 },\n          e\n        );\n        break;\n      // -\n      case 189:\n        self.zoom(\n          -self.options.ratioThreshold * 3,\n          { x: self.$stage.width() / 2, y: self.$stage.height() / 2 },\n          e\n        );\n        break;\n      // + Firefox\n      case 61:\n        self.zoom(\n          self.options.ratioThreshold * 3,\n          { x: self.$stage.width() / 2, y: self.$stage.height() / 2 },\n          e\n        );\n        break;\n      // - Firefox\n      case 173:\n        self.zoom(\n          -self.options.ratioThreshold * 3,\n          { x: self.$stage.width() / 2, y: self.$stage.height() / 2 },\n          e\n        );\n        break;\n      // Ctrl + Alt + 0\n      case 48:\n        if (ctrlKey && altKey) {\n          self.zoomTo(\n            1,\n            { x: self.$stage.width() / 2, y: self.$stage.height() / 2 },\n            e\n          );\n        }\n        break;\n      // Ctrl + ,\n      case 188:\n        if (ctrlKey) {\n          self.rotate(-90);\n        }\n        break;\n      // Ctrl + .\n      case 190:\n        if (ctrlKey) {\n          self.rotate(90);\n        }\n        break;\n      // Q\n      case 81:\n        this.close();\n        break;\n      default:\n    }\n  },\n  _addEvents: function () {\n    var self = this;\n\n    this.$close.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n      self.close();\n    });\n\n    this.$stage.off(WHEEL_EVENT + EVENT_NS).on(WHEEL_EVENT + EVENT_NS, function (e) {\n      self.wheel(e);\n    });\n\n    this.$zoomIn.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n      self.zoom(\n        self.options.ratioThreshold * 3,\n        { x: self.$stage.width() / 2, y: self.$stage.height() / 2 },\n        e\n      );\n    });\n\n    this.$zoomOut.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n      self.zoom(\n        -self.options.ratioThreshold * 3,\n        { x: self.$stage.width() / 2, y: self.$stage.height() / 2 },\n        e\n      );\n    });\n\n    this.$actualSize.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n      self.zoomTo(\n        1,\n        { x: self.$stage.width() / 2, y: self.$stage.height() / 2 },\n        e\n      );\n    });\n\n    this.$prev.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n      self.jump(-1);\n    });\n\n    this.$fullscreen.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n      self.fullscreen();\n    });\n\n    this.$next.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n      self.jump(1);\n    });\n\n    this.$rotateLeft.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n      self.rotate(-90);\n    });\n\n    this.$rotateRight.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n      self.rotate(90);\n    });\n\n    this.$maximize.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function () {\n      self.maximize();\n    });\n\n    this.$magnify.off(KEYDOWN_EVENT + EVENT_NS).on(KEYDOWN_EVENT + EVENT_NS, function (e) {\n      self._keydown(e);\n    });\n\n    $W.on(RESIZE_EVENT + EVENT_NS, self.resize());\n  },\n  _addCustomButtonEvents: function () {\n    var self = this;\n\n    for (var btnKey in self.options.customButtons) {\n      this.$magnify.find('.magnify-button-' + btnKey)\n        .off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\n          self.options.customButtons[btnKey].click.apply(self, [self, e]);\n        });\n    }\n  },\n  _triggerHook: function (e, data) {\n    if (this.options.callbacks[e]) {\n      this.options.callbacks[e].apply(this, $.isArray(data) ? data : [data]);\n    }\n  }\n};\n\n/**\n * jQuery plugin\n */\n\n$.fn.magnify = function (options) {\n  jqEl = $(this);\n\n  // Convert a numeric string into a number\n  for (var key in options) {\n    if (typeof options[key] === 'string' && !isNaN(options[key])) {\n      options[key] = parseFloat(options[key]);\n    }\n  }\n\n  // Get init event, 'click' or 'dblclick'\n  var opts = $.extend(true, {}, DEFAULTS, options);\n\n  // We should get zIndex of options before plugin's init.\n  PUBLIC_VARS['zIndex'] = opts.zIndex;\n\n  if (typeof options === 'string') {\n    // $(this).data('magnify')[options]();\n  } else {\n    if (opts.initEvent === 'dblclick') {\n      jqEl.off('click' + EVENT_NS).on('click' + EVENT_NS, function (e) {\n        e.preventDefault();\n        // This will stop triggering data-api event\n        e.stopPropagation();\n      });\n    }\n\n    jqEl.off(opts.initEvent + EVENT_NS).on(opts.initEvent + EVENT_NS, function (e) {\n      e.preventDefault();\n      // This will stop triggering data-api event\n      e.stopPropagation();\n\n      $(this).data('magnify', new Magnify(this, options));\n    });\n  }\n\n  return jqEl;\n};\n\n/**\n * MAGNIFY DATA-API\n */\n$D.on(CLICK_EVENT + EVENT_NS, '[data-magnify]', function (e) {\n  jqEl = $('[data-magnify]');\n\n  e.preventDefault();\n\n  $(this).data('magnify', new Magnify(this, DEFAULTS));\n});\n\n/**\n * Draggable\n * @param {Object} modal - The modal element\n * @param {Object} dragHandle - The handle element when dragging\n * @param {Object} dragCancel - The cancel element when dragging\n */\n\nvar draggable = function (modal, dragHandle, dragCancel) {\n  var self = this;\n\n  var isDragging = false;\n\n  var startX = 0, startY = 0, left = 0, top = 0;\n\n  var dragStart = function (e) {\n    e = e || window.event;\n\n    // Must be removed\n    // e.preventDefault();\n\n    modal.focus();\n\n    // Get clicked button\n    var elemCancel = $(e.target).closest(dragCancel);\n    // Stop modal moving when click buttons\n    if (elemCancel.length) {\n      return true;\n    }\n\n    if (self.options.multiInstances) {\n      modal.css('z-index', ++PUBLIC_VARS['zIndex']);\n    }\n\n    isDragging = true;\n\n    startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n    startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n\n    left = $(modal).offset().left;\n    top = $(modal).offset().top;\n\n    $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).on(\n      TOUCH_END_EVENT + EVENT_NS,\n      dragEnd\n    );\n  };\n\n  var dragMove = function (e) {\n    e = e || window.event;\n\n    e.preventDefault();\n\n    if (isDragging && !PUBLIC_VARS['isMoving'] && !PUBLIC_VARS['isResizing'] && !self.isMaximized) {\n      var endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      var endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n      var relativeX = endX - startX;\n      var relativeY = endY - startY;\n\n      $(modal).css({\n        left: relativeX + left + 'px',\n        top: relativeY + top + 'px'\n      });\n    }\n  };\n\n  var dragEnd = function (e) {\n    $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).off(\n      TOUCH_END_EVENT + EVENT_NS,\n      dragEnd\n    );\n\n    isDragging = false;\n  };\n\n  $(dragHandle).on(TOUCH_START_EVENT + EVENT_NS, dragStart);\n};\n\n// Add to Magnify Prototype\n$.extend(Magnify.prototype, {\n  draggable: draggable\n});\n\n/**\n * --------------------------------------------------------------------------\n * 1. No movable\n * 2. Vertical movable\n * 3. Horizontal movable\n * 4. Vertical & Horizontal movable\n * --------------------------------------------------------------------------\n *\n * Image movable\n * @param {Object} stage - The stage element\n * @param {Object} image - The image element\n */\n\nvar movable = function (stage, image) {\n  var self = this;\n\n  var isDragging = false;\n\n  var startX = 0,\n    startY = 0,\n    left = 0,\n    top = 0,\n    widthDiff = 0,\n    heightDiff = 0,\n    δ = 0;\n\n  var dragStart = function (e) {\n    e = e || window.event;\n\n    e.preventDefault();\n\n    var $image = isIE8() ? $(stage).find(image) : $(image);\n\n    var imageWidth = $image.width(),\n      imageHeight = $image.height(),\n      stageWidth = $(stage).width(),\n      stageHeight = $(stage).height();\n\n    startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n    startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n\n    // δ is the difference between image width and height\n    δ = !self.isRotated ? 0 : (imageWidth - imageHeight) / 2;\n\n    // Width or height difference can be use to limit image right or top position\n    widthDiff = !self.isRotated ? imageWidth - stageWidth : imageHeight - stageWidth;\n    heightDiff = !self.isRotated ? imageHeight - stageHeight : imageWidth - stageHeight;\n\n    // Modal can be dragging if image is smaller to stage\n    isDragging = widthDiff > 0 || heightDiff > 0 ? true : false;\n    PUBLIC_VARS['isMoving'] = widthDiff > 0 || heightDiff > 0 ? true : false;\n\n    // Reclac the element position when mousedown\n    // Fixed the issue of stage with a border\n    left = $image.position().left - (isIE8() ? 0 : δ);\n    top = $image.position().top + (isIE8() ? 0 : δ);\n\n    // Add grabbing cursor\n    if (stage.hasClass('is-grab')) {\n      $('html, body, .magnify-modal, .magnify-stage, .magnify-button, .magnify-resizable-handle')\n        .addClass('is-grabbing');\n    }\n\n    $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).on(\n      TOUCH_END_EVENT + EVENT_NS,\n      dragEnd\n    );\n  };\n\n  var dragMove = function (e) {\n    e = e || window.event;\n\n    e.preventDefault();\n\n    var $image = isIE8() ? $(stage).find(image) : $(image);\n\n    if (isDragging) {\n      var endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      var endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n      var relativeX = endX - startX;\n      var relativeY = endY - startY;\n      var newLeft = relativeX + left;\n      var newTop = relativeY + top;\n\n      // Vertical limit\n      if (heightDiff > 0) {\n        if (relativeY + top > δ) {\n          newTop = δ;\n        } else if (relativeY + top < -heightDiff + δ) {\n          newTop = -heightDiff + δ;\n        }\n      } else {\n        newTop = top;\n      }\n      // Horizontal limit\n      if (widthDiff > 0) {\n        if (relativeX + left > -δ) {\n          newLeft = -δ;\n        } else if (relativeX + left < -widthDiff - δ) {\n          newLeft = -widthDiff - δ;\n        }\n      } else {\n        newLeft = left;\n      }\n\n      $image.css({\n        left: newLeft + 'px',\n        top: newTop + 'px'\n      });\n\n      // Update image initial data\n      $.extend(self.imageData, {\n        left: newLeft,\n        top: newTop\n      });\n    }\n  };\n\n  var dragEnd = function (e) {\n    $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).off(\n      TOUCH_END_EVENT + EVENT_NS,\n      dragEnd\n    );\n\n    isDragging = false;\n    PUBLIC_VARS['isMoving'] = false;\n\n    // Remove grabbing cursor\n    $('html, body, .magnify-modal, .magnify-stage, .magnify-button, .magnify-resizable-handle')\n      .removeClass('is-grabbing');\n  };\n\n  $(stage).on(TOUCH_START_EVENT + EVENT_NS, dragStart);\n};\n\n// Add to Magnify Prototype\n$.extend(Magnify.prototype, {\n  movable: movable\n});\n\n/**\n * --------------------------------------------------------------------------\n * 1. Modal resizable\n * 2. Keep image in stage center\n * 3. Other image limitations\n * --------------------------------------------------------------------------\n *\n * Resizable\n * @param {Object} modal - The modal element\n * @param {Object} stage - The stage element\n * @param {Object} image - The image element\n * @param {Number} minWidth - The option of modalWidth\n * @param {Number} minHeight - The option of modalHeight\n */\n\nvar resizable = function (modal, stage, image, minWidth, minHeight) {\n  var self = this;\n\n  var resizableHandleE = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-e\"></div>'),\n    resizableHandleW = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-w\"></div>'),\n    resizableHandleS = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-s\"></div>'),\n    resizableHandleN = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-n\"></div>'),\n    resizableHandleSE = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-se\"></div>'),\n    resizableHandleSW = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-sw\"></div>'),\n    resizableHandleNE = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-ne\"></div>'),\n    resizableHandleNW = $('<div class=\"magnify-resizable-handle magnify-resizable-handle-nw\"></div>');\n\n  var resizableHandles = {\n    e: resizableHandleE,\n    w: resizableHandleW,\n    s: resizableHandleS,\n    n: resizableHandleN,\n    se: resizableHandleSE,\n    sw: resizableHandleSW,\n    ne: resizableHandleNE,\n    nw: resizableHandleNW\n  };\n\n  $(modal).append(\n    resizableHandleE,\n    resizableHandleW,\n    resizableHandleS,\n    resizableHandleN,\n    resizableHandleSE,\n    resizableHandleSW,\n    resizableHandleNE,\n    resizableHandleNW\n  );\n\n  var isDragging = false;\n\n  var startX = 0,\n    startY = 0,\n    modalData = {\n      w: 0,\n      h: 0,\n      l: 0,\n      t: 0\n    },\n    stageData = {\n      w: 0,\n      h: 0,\n      l: 0,\n      t: 0\n    },\n    imageData = {\n      w: 0,\n      h: 0,\n      l: 0,\n      t: 0\n    };\n  // δ is the difference between image width and height\n  var δ = 0, imgWidth = 0, imgHeight = 0, direction = '';\n\n  // Modal CSS options\n  var getModalOpts = function (dir, offsetX, offsetY) {\n    // Modal should not move when its width to the minwidth\n    var modalLeft = -offsetX + modalData.w > minWidth\n      ? offsetX + modalData.l\n      : modalData.l + modalData.w - minWidth;\n    var modalTop = -offsetY + modalData.h > minHeight\n      ? offsetY + modalData.t\n      : modalData.t + modalData.h - minHeight;\n\n    var opts = {\n      e: {\n        width: Math.max(offsetX + modalData.w, minWidth) + 'px'\n      },\n      s: {\n        height: Math.max(offsetY + modalData.h, minHeight) + 'px'\n      },\n      se: {\n        width: Math.max(offsetX + modalData.w, minWidth) + 'px',\n        height: Math.max(offsetY + modalData.h, minHeight) + 'px'\n      },\n      w: {\n        width: Math.max(-offsetX + modalData.w, minWidth) + 'px',\n        left: modalLeft + 'px'\n      },\n      n: {\n        height: Math.max(-offsetY + modalData.h, minHeight) + 'px',\n        top: modalTop + 'px'\n      },\n      nw: {\n        width: Math.max(-offsetX + modalData.w, minWidth) + 'px',\n        height: Math.max(-offsetY + modalData.h, minHeight) + 'px',\n        top: modalTop + 'px',\n        left: modalLeft + 'px'\n      },\n      ne: {\n        width: Math.max(offsetX + modalData.w, minWidth) + 'px',\n        height: Math.max(-offsetY + modalData.h, minHeight) + 'px',\n        top: modalTop + 'px'\n      },\n      sw: {\n        width: Math.max(-offsetX + modalData.w, minWidth) + 'px',\n        height: Math.max(offsetY + modalData.h, minHeight) + 'px',\n        left: modalLeft + 'px'\n      }\n    };\n\n    return opts[dir];\n  };\n\n  // Image CSS options\n  var getImageOpts = function (dir, offsetX, offsetY) {\n    var $image = isIE8() ? $(stage).find(image) : $(image);\n\n    // In modern browser, the width and height of image won't change after rotated.\n    // But its position top and left will get values from the image rotated.\n    // In IE8 browser, due to the type of rotating, all the value will be the same.\n    var imgPosLeft = isIE8() ? $image.position().left + δ : $image.position().left;\n    var imgPosTop = isIE8() ? $image.position().top - δ : $image.position().top;\n\n    // Image should not move when modal width to the min width\n    // The minwidth is modal width, so we should clac the stage minwidth\n    var widthDiff = offsetX + modalData.w > minWidth\n      ? stageData.w - imgWidth + offsetX - δ\n      : minWidth - (modalData.w - stageData.w) - imgWidth - δ;\n    var heightDiff = offsetY + modalData.h > minHeight\n      ? stageData.h - imgHeight + offsetY + δ\n      : minHeight - (modalData.h - stageData.h) - imgHeight + δ;\n    var widthDiff2 = -offsetX + modalData.w > minWidth\n      ? stageData.w - imgWidth - offsetX - δ\n      : minWidth - (modalData.w - stageData.w) - imgWidth - δ;\n    var heightDiff2 = -offsetY + modalData.h > minHeight\n      ? stageData.h - imgHeight - offsetY + δ\n      : minHeight - (modalData.h - stageData.h) - imgHeight + δ;\n\n    // Get image position in dragging\n    var imgLeft = (widthDiff > 0 ? imgPosLeft : imgPosLeft < 0 ? imgPosLeft : 0) - δ;\n    var imgTop = (heightDiff > 0 ? imgPosTop : imgPosTop < 0 ? imgPosTop : 0) + δ;\n    var imgLeft2 = (widthDiff2 > 0 ? imgPosLeft : imgPosLeft < 0 ? imgPosLeft : 0) - δ;\n    var imgTop2 = (heightDiff2 > 0 ? imgPosTop : imgPosTop < 0 ? imgPosTop : 0) + δ;\n\n    var opts = {\n      e: {\n        left: widthDiff >= -δ\n          ? (widthDiff - δ) / 2 + 'px'\n          : imgLeft > widthDiff\n            ? imgLeft + 'px'\n            : widthDiff + 'px'\n      },\n      s: {\n        top: heightDiff >= δ\n          ? (heightDiff + δ) / 2 + 'px'\n          : imgTop > heightDiff\n            ? imgTop + 'px'\n            : heightDiff + 'px'\n      },\n      se: {\n        top: heightDiff >= δ\n          ? (heightDiff + δ) / 2 + 'px'\n          : imgTop > heightDiff\n            ? imgTop + 'px'\n            : heightDiff + 'px',\n        left: widthDiff >= -δ\n          ? (widthDiff - δ) / 2 + 'px'\n          : imgLeft > widthDiff\n            ? imgLeft + 'px'\n            : widthDiff + 'px'\n      },\n      w: {\n        left: widthDiff2 >= -δ\n          ? (widthDiff2 - δ) / 2 + 'px'\n          : imgLeft2 > widthDiff2\n            ? imgLeft2 + 'px'\n            : widthDiff2 + 'px'\n      },\n      n: {\n        top: heightDiff2 >= δ\n          ? (heightDiff2 + δ) / 2 + 'px'\n          : imgTop2 > heightDiff2\n            ? imgTop2 + 'px'\n            : heightDiff2 + 'px'\n      },\n      nw: {\n        top: heightDiff2 >= δ\n          ? (heightDiff2 + δ) / 2 + 'px'\n          : imgTop2 > heightDiff2\n            ? imgTop2 + 'px'\n            : heightDiff2 + 'px',\n        left: widthDiff2 >= -δ\n          ? (widthDiff2 - δ) / 2 + 'px'\n          : imgLeft2 > widthDiff2\n            ? imgLeft2 + 'px'\n            : widthDiff2 + 'px'\n      },\n      ne: {\n        top: heightDiff2 >= δ\n          ? (heightDiff2 + δ) / 2 + 'px'\n          : imgTop2 > heightDiff2\n            ? imgTop2 + 'px'\n            : heightDiff2 + 'px',\n        left: widthDiff >= -δ\n          ? (widthDiff - δ) / 2 + 'px'\n          : imgLeft > widthDiff\n            ? imgLeft + 'px'\n            : widthDiff + 'px'\n      },\n      sw: {\n        top: heightDiff >= δ\n          ? (heightDiff + δ) / 2 + 'px'\n          : imgTop > heightDiff\n            ? imgTop + 'px'\n            : heightDiff + 'px',\n        left: widthDiff2 >= -δ\n          ? (widthDiff2 - δ) / 2 + 'px'\n          : imgLeft2 > widthDiff2\n            ? imgLeft2 + 'px'\n            : widthDiff2 + 'px'\n      }\n    };\n\n    return opts[dir];\n  };\n\n  var dragStart = function (dir, e) {\n    e = e || window.event;\n\n    e.preventDefault();\n\n    var $image = isIE8() ? $(stage).find(image) : $(image);\n\n    isDragging = true;\n    PUBLIC_VARS['isResizing'] = true;\n\n    startX = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n    startY = e.type === 'touchstart' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n\n    // Reclac the modal data when mousedown\n    modalData = {\n      w: $(modal).width(),\n      h: $(modal).height(),\n      l: $(modal).offset().left,\n      t: $(modal).offset().top\n    };\n\n    stageData = {\n      w: $(stage).width(),\n      h: $(stage).height(),\n      l: $(stage).offset().left,\n      t: $(stage).offset().top\n    };\n\n    imageData = {\n      w: $image.width(),\n      h: $image.height(),\n      l: $image.position().left,\n      t: $image.position().top\n    };\n\n    // δ is the difference between image width and height\n    δ = !self.isRotated ? 0 : (imageData.w - imageData.h) / 2;\n    imgWidth = !self.isRotated ? imageData.w : imageData.h;\n    imgHeight = !self.isRotated ? imageData.h : imageData.w;\n\n    direction = dir;\n\n    // Add resizable cursor\n    $('html,body,.magnify-modal,.magnify-stage,.magnify-button').css(\n      'cursor',\n      dir + '-resize'\n    );\n\n    $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).on(\n      TOUCH_END_EVENT + EVENT_NS,\n      dragEnd\n    );\n  };\n\n  var dragMove = function (e) {\n    e = e || window.event;\n\n    e.preventDefault();\n\n    var $image = isIE8() ? $(stage).find(image) : $(image);\n\n    if (isDragging && !self.isMaximized) {\n      var endX = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageX : e.clientX;\n      var endY = e.type === 'touchmove' ? e.originalEvent.targetTouches[0].pageY : e.clientY;\n      var relativeX = endX - startX;\n      var relativeY = endY - startY;\n\n      var modalOpts = getModalOpts(direction, relativeX, relativeY);\n\n      $(modal).css(modalOpts);\n\n      var imageOpts = getImageOpts(direction, relativeX, relativeY);\n\n      $image.css(imageOpts);\n\n      self.isDoResize = true;\n    }\n  };\n\n  var dragEnd = function (e) {\n    $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove).off(\n      TOUCH_END_EVENT + EVENT_NS,\n      dragEnd\n    );\n\n    // Set grab cursor\n    if (PUBLIC_VARS['isResizing']) {\n      setGrabCursor(\n        { w: imgWidth, h: imgHeight },\n        { w: $(stage).width(), h: $(stage).height() },\n        stage\n      );\n    }\n\n    isDragging = false;\n    PUBLIC_VARS['isResizing'] = false;\n\n    // Remove resizable cursor\n    $('html, body, .magnify-modal, .magnify-stage, .magnify-button').css('cursor', '');\n\n    // Update image initial data\n    var scale = self.getImageScaleToStage($(stage).width(), $(stage).height());\n\n    $.extend(self.imageData, {\n      initWidth: self.img.width * scale,\n      initHeight: self.img.height * scale,\n      initLeft: ($(stage).width() - self.img.width * scale) / 2,\n      initTop: ($(stage).height() - self.img.height * scale) / 2\n    });\n  };\n\n  $.each(resizableHandles, function (dir, handle) {\n    handle.on(TOUCH_START_EVENT + EVENT_NS, function (e) {\n      dragStart(dir, e);\n    });\n  });\n};\n\n// Add to Magnify Prototype\n$.extend(Magnify.prototype, {\n  resizable: resizable\n});\n\n});\n\n// VERSION: 2.3 LAST UPDATE: 11.07.2013\n/*\n * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php\n *\n * Made by Wilq32, wilq32@gmail.com, Wroclaw, Poland, 01.2009\n * Website: http://jqueryrotate.com\n */\n\n(function($) {\n  var supportedCSS, supportedCSSOrigin, styles = document.getElementsByTagName('head')[0].style,\n    toCheck = 'transformProperty WebkitTransform OTransform msTransform MozTransform'.split(' ');\n  for (var a = 0; a < toCheck.length; a++)\n    if (styles[toCheck[a]] !== undefined) { supportedCSS = toCheck[a]; }\n  if (supportedCSS) {\n    supportedCSSOrigin = supportedCSS.replace(/[tT]ransform/, 'TransformOrigin');\n    if (supportedCSSOrigin[0] == 'T') supportedCSSOrigin[0] = 't';\n  }\n\n  // Bad eval to preven google closure to remove it from code o_O\n  eval('IE = \"v\"==\"\\v\"');\n\n  jQuery.fn.extend({\n    rotate: function(parameters) {\n      if (this.length === 0 || typeof parameters == 'undefined') return;\n      if (typeof parameters == 'number') parameters = { angle: parameters };\n      var returned = [];\n      for (var i = 0, i0 = this.length; i < i0; i++) {\n        var element = this.get(i);\n        if (!element.Wilq32 || !element.Wilq32.PhotoEffect) {\n\n          var paramClone = $.extend(true, {}, parameters);\n          var newRotObject = new Wilq32.PhotoEffect(element, paramClone)._rootObj;\n\n          returned.push($(newRotObject));\n        } else {\n          element.Wilq32.PhotoEffect._handleRotation(parameters);\n        }\n      }\n      return returned;\n    },\n    getRotateAngle: function() {\n      var ret = [0];\n      for (var i = 0, i0 = this.length; i < i0; i++) {\n        var element = this.get(i);\n        if (element.Wilq32 && element.Wilq32.PhotoEffect) {\n          ret[i] = element.Wilq32.PhotoEffect._angle;\n        }\n      }\n      return ret;\n    },\n    stopRotate: function() {\n      for (var i = 0, i0 = this.length; i < i0; i++) {\n        var element = this.get(i);\n        if (element.Wilq32 && element.Wilq32.PhotoEffect) {\n          clearTimeout(element.Wilq32.PhotoEffect._timer);\n        }\n      }\n    }\n  });\n\n  // Library agnostic interface\n\n  Wilq32 = window.Wilq32 || {};\n  Wilq32.PhotoEffect = (function() {\n\n    if (supportedCSS) {\n      return function(img, parameters) {\n        img.Wilq32 = {\n          PhotoEffect: this\n        };\n\n        this._img = this._rootObj = this._eventObj = img;\n        this._handleRotation(parameters);\n      };\n    } else {\n      return function(img, parameters) {\n        this._img = img;\n        this._onLoadDelegate = [parameters];\n\n        this._rootObj = document.createElement('span');\n        this._rootObj.style.display = 'inline-block';\n        this._rootObj.Wilq32 = {\n          PhotoEffect: this\n        };\n        img.parentNode.insertBefore(this._rootObj, img);\n\n        if (img.complete) {\n          this._Loader();\n        } else {\n          var self = this;\n          // TODO: Remove jQuery dependency\n          jQuery(this._img).bind('load', function() { self._Loader(); });\n        }\n      };\n    }\n  })();\n\n  Wilq32.PhotoEffect.prototype = {\n    _setupParameters: function(parameters) {\n      this._parameters = this._parameters || {};\n      if (typeof this._angle !== 'number') { this._angle = 0; }\n      if (typeof parameters.angle === 'number') { this._angle = parameters.angle; }\n      this._parameters.animateTo = (typeof parameters.animateTo === 'number') ? (parameters.animateTo) : (this._angle);\n\n      this._parameters.step = parameters.step || this._parameters.step || null;\n      this._parameters.easing = parameters.easing || this._parameters.easing || this._defaultEasing;\n      this._parameters.duration = 'duration' in parameters ? parameters.duration : parameters.duration || this._parameters.duration || 1000;\n      this._parameters.callback = parameters.callback || this._parameters.callback || this._emptyFunction;\n      this._parameters.center = parameters.center || this._parameters.center || ['50%', '50%'];\n      if (typeof this._parameters.center[0] == 'string') {\n        this._rotationCenterX = (parseInt(this._parameters.center[0], 10) / 100) * this._imgWidth * this._aspectW;\n      } else {\n        this._rotationCenterX = this._parameters.center[0];\n      }\n      if (typeof this._parameters.center[1] == 'string') {\n        this._rotationCenterY = (parseInt(this._parameters.center[1], 10) / 100) * this._imgHeight * this._aspectH;\n      } else {\n        this._rotationCenterY = this._parameters.center[1];\n      }\n\n      if (parameters.bind && parameters.bind != this._parameters.bind) { this._BindEvents(parameters.bind); }\n    },\n    _emptyFunction: function() {},\n    _defaultEasing: function(x, t, b, c, d) { return -c * ((t = t / d - 1) * t * t * t - 1) + b; },\n    _handleRotation: function(parameters, dontcheck) {\n      if (!supportedCSS && !this._img.complete && !dontcheck) {\n        this._onLoadDelegate.push(parameters);\n        return;\n      }\n      this._setupParameters(parameters);\n      if (this._angle == this._parameters.animateTo) {\n        this._rotate(this._angle);\n      } else {\n        this._animateStart();\n      }\n    },\n\n    _BindEvents: function(events) {\n      if (events && this._eventObj) {\n        // Unbinding previous Events\n        if (this._parameters.bind) {\n          var oldEvents = this._parameters.bind;\n          for (var a in oldEvents)\n            if (oldEvents.hasOwnProperty(a))\n              // TODO: Remove jQuery dependency\n              jQuery(this._eventObj).unbind(a, oldEvents[a]);\n        }\n\n        this._parameters.bind = events;\n        for (var a in events)\n          if (events.hasOwnProperty(a))\n            // TODO: Remove jQuery dependency\n            jQuery(this._eventObj).bind(a, events[a]);\n      }\n    },\n\n    _Loader: (function() {\n      if (IE)\n        return function() {\n          var width = this._img.width;\n          var height = this._img.height;\n          this._imgWidth = width;\n          this._imgHeight = height;\n          this._img.parentNode.removeChild(this._img);\n\n          this._vimage = this.createVMLNode('image');\n          this._vimage.src = this._img.src;\n          this._vimage.style.height = height + 'px';\n          this._vimage.style.width = width + 'px';\n          this._vimage.style.position = 'absolute'; // FIXES IE PROBLEM - its only rendered if its on absolute position!\n          this._vimage.style.top = '0px';\n          this._vimage.style.left = '0px';\n          this._aspectW = this._aspectH = 1;\n\n          /* Group minifying a small 1px precision problem when rotating object */\n          this._container = this.createVMLNode('group');\n          this._container.style.width = width;\n          this._container.style.height = height;\n          this._container.style.position = 'absolute';\n          this._container.style.top = '0px';\n          this._container.style.left = '0px';\n          this._container.setAttribute('coordsize', width - 1 + ',' + (height - 1)); // This -1, -1 trying to fix ugly problem with small displacement on IE\n          this._container.appendChild(this._vimage);\n\n          this._rootObj.appendChild(this._container);\n          this._rootObj.style.position = 'relative'; // FIXES IE PROBLEM\n          this._rootObj.style.width = width + 'px';\n          this._rootObj.style.height = height + 'px';\n          this._rootObj.setAttribute('id', this._img.getAttribute('id'));\n          this._rootObj.className = this._img.className;\n          this._eventObj = this._rootObj;\n          var parameters;\n          while (parameters = this._onLoadDelegate.shift()) {\n            this._handleRotation(parameters, true);\n          }\n        };\n      else return function() {\n        this._rootObj.setAttribute('id', this._img.getAttribute('id'));\n        this._rootObj.className = this._img.className;\n\n        this._imgWidth = this._img.naturalWidth;\n        this._imgHeight = this._img.naturalHeight;\n        var _widthMax = Math.sqrt((this._imgHeight) * (this._imgHeight) + (this._imgWidth) * (this._imgWidth));\n        this._width = _widthMax * 3;\n        this._height = _widthMax * 3;\n\n        this._aspectW = this._img.offsetWidth / this._img.naturalWidth;\n        this._aspectH = this._img.offsetHeight / this._img.naturalHeight;\n\n        this._img.parentNode.removeChild(this._img);\n\n\n        this._canvas = document.createElement('canvas');\n        this._canvas.setAttribute('width', this._width);\n        this._canvas.style.position = 'relative';\n        this._canvas.style.left = -this._img.height * this._aspectW + 'px';\n        this._canvas.style.top = -this._img.width * this._aspectH + 'px';\n        this._canvas.Wilq32 = this._rootObj.Wilq32;\n\n        this._rootObj.appendChild(this._canvas);\n        this._rootObj.style.width = this._img.width * this._aspectW + 'px';\n        this._rootObj.style.height = this._img.height * this._aspectH + 'px';\n        this._eventObj = this._canvas;\n\n        this._cnv = this._canvas.getContext('2d');\n        var parameters;\n        while (parameters = this._onLoadDelegate.shift()) {\n          this._handleRotation(parameters, true);\n        }\n      };\n    })(),\n\n    _animateStart: function() {\n      if (this._timer) {\n        clearTimeout(this._timer);\n      }\n      this._animateStartTime = +new Date;\n      this._animateStartAngle = this._angle;\n      this._animate();\n    },\n    _animate: function() {\n      var actualTime = +new Date;\n      var checkEnd = actualTime - this._animateStartTime > this._parameters.duration;\n\n      // TODO: Bug for animatedGif for static rotation ? (to test)\n      if (checkEnd && !this._parameters.animatedGif) {\n        clearTimeout(this._timer);\n      } else {\n        if (this._canvas || this._vimage || this._img) {\n          var angle = this._parameters.easing(0, actualTime - this._animateStartTime, this._animateStartAngle, this._parameters.animateTo - this._animateStartAngle, this._parameters.duration);\n          this._rotate((~~(angle * 10)) / 10);\n        }\n        if (this._parameters.step) {\n          this._parameters.step(this._angle);\n        }\n        var self = this;\n        this._timer = setTimeout(function() {\n          self._animate.call(self);\n        }, 10);\n      }\n\n      // To fix Bug that prevents using recursive function in callback I moved this function to back\n      if (this._parameters.callback && checkEnd) {\n        this._angle = this._parameters.animateTo;\n        this._rotate(this._angle);\n        this._parameters.callback.call(this._rootObj);\n      }\n    },\n\n    _rotate: (function() {\n      var rad = Math.PI / 180;\n      if (IE)\n        return function(angle) {\n          this._angle = angle;\n          this._container.style.rotation = (angle % 360) + 'deg';\n          this._vimage.style.top = -(this._rotationCenterY - this._imgHeight / 2) + 'px';\n          this._vimage.style.left = -(this._rotationCenterX - this._imgWidth / 2) + 'px';\n          this._container.style.top = this._rotationCenterY - this._imgHeight / 2 + 'px';\n          this._container.style.left = this._rotationCenterX - this._imgWidth / 2 + 'px';\n\n        };\n      else if (supportedCSS)\n        return function(angle) {\n          this._angle = angle;\n          this._img.style[supportedCSS] = 'rotate(' + (angle % 360) + 'deg)';\n          this._img.style[supportedCSSOrigin] = this._parameters.center.join(' ');\n        };\n      else\n        return function(angle) {\n          this._angle = angle;\n          angle = (angle % 360) * rad;\n          // clear canvas\n          this._canvas.width = this._width; //+this._widthAdd;\n          this._canvas.height = this._height; //+this._heightAdd;\n\n          // REMEMBER: all drawings are read from backwards.. so first function is translate, then rotate, then translate, translate..\n          this._cnv.translate(this._imgWidth * this._aspectW, this._imgHeight * this._aspectH); // at least center image on screen\n          this._cnv.translate(this._rotationCenterX, this._rotationCenterY); // we move image back to its orginal\n          this._cnv.rotate(angle); // rotate image\n          this._cnv.translate(-this._rotationCenterX, -this._rotationCenterY); // move image to its center, so we can rotate around its center\n          this._cnv.scale(this._aspectW, this._aspectH); // SCALE - if needed ;)\n          this._cnv.drawImage(this._img, 0, 0); // First - we draw image\n        };\n\n    })()\n  };\n\n  if (IE) {\n    Wilq32.PhotoEffect.prototype.createVMLNode = (function() {\n      document.createStyleSheet().addRule('.rvml', 'behavior:url(#default#VML)');\n      try {\n        !document.namespaces.rvml && document.namespaces.add('rvml', 'urn:schemas-microsoft-com:vml');\n        return function(tagName) {\n          return document.createElement('<rvml:' + tagName + ' class=\"rvml\">');\n        };\n      } catch (e) {\n        return function(tagName) {\n          return document.createElement('<' + tagName + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"rvml\">');\n        };\n      }\n    })();\n  }\n\n})(jQuery);\n"]},"metadata":{},"sourceType":"script"}